"use strict";angular.module("timeclubAngularApp",["ngResource","ui.router","ui.bootstrap","lbServices","ui.bootstrap.datetimepicker","ui.mask","LocalStorageModule","angularChart","angularUtils.directives.dirPagination"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){a.state("app",{url:"/",views:{header:{templateUrl:"views/header.html",controller:"HeaderCtrl"},content:{templateUrl:"views/main.html",controller:"MainCtrl"},footer:{templateUrl:"views/footer.html"}}}).state("app.reservations",{url:"reservations",views:{"content@":{templateUrl:"views/reservations.html",controller:"ReservationCtrl"}}}).state("app.dashboard",{url:"dashboard",views:{"content@":{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}}}).state("app.history",{url:"history",views:{"content@":{templateUrl:"views/history.html",controller:"HistoryCtrl"}}}).state("app.stat",{url:"stat",views:{"content@":{templateUrl:"views/stat.html",controller:"StatCtrl"}}}).state("app.clients",{url:"clients",views:{"content@":{templateUrl:"views/clients.html",controller:"ClientsCtrl"}}}).state("app.preferences",{url:"preferences",views:{"content@":{templateUrl:"views/preferences.html",controller:"PreferencesCtrl"}}}).state("app.login",{url:"login",views:{"header@":{templateUrl:"views/header-login.html"},"content@":{templateUrl:"views/login.html",controller:"LoginCtrl"}}}).state("Modal",{views:{modal:{templateUrl:"views/modal.html",controller:"MainCtrl"}},"abstract":!0}).state("Modal.confirmClose",{views:{modal:{templateUrl:"views/confirm.html",controller:"CheckoutCtrl"}}}).state("app.emplwages",{url:"emplwages",views:{"content@":{templateUrl:"views/emplwages.html",controller:"EmplWagesCtrl"}}}).state("Modal.checkoutDetails",{views:{modal:{templateUrl:"views/checkoutdetails.html",controller:"CheckoutDetailsCtrl"}},onEnter:["$state",function(a){$(document).on("keyup",function(b){27==b.keyCode&&($(document).off("keyup"),a.go("app"))}),$(document).on("click",".Modal-backdrop, .Modal-holder",function(){a.go("app")}),$(document).on("click",".Modal-box, .Modal-box *",function(a){a.stopPropagation()})}]}),b.otherwise("/"),c.setPrefix("timeclubAngularApp").setStorageType("localStorage")}]).run(["$rootScope","$location","$http","User","localStorageService","textConsts",function(a,b,c,d,e,f){a.adminRoleName=f.getAdminRoleName(),a.oneDayInMSec=f.getOneDayInMSec(),e.isSupported&&(a.currentUserId=e.get("currentUserId"),a.currentUserName=e.get("currentUserName"),a.currentUserRole=e.get("currentUserRole"),a.isAdmin=e.get("isAdmin")),a.$on("$stateChangeStart",function(a,b,c,d,e){$("#ui-view").html(""),$(".page-loading").removeClass("hidden")}),a.$on("$stateChangeSuccess",function(a,b,c,d,e){$(".page-loading").addClass("hidden")}),a.$on("$locationChangeStart",function(a,c,e){var f=-1===$.inArray(b.path(),["/login","/register"]);f&&!d.isAuthenticated()&&(console.log("Not Authenticated"),b.path("/login")),d.isAuthenticated()&&b.path("/")})}]).filter("phoneFilter",function(){return function(a){var b="";return b="+7("+a.slice(0,3)+")"+a.slice(3,6)+" "+a.slice(6,8)+" "+a.slice(8,10)}}),angular.module("timeclubAngularApp").controller("MainCtrl",["$scope","guestFactory","guestCompute","clientFactory","activePromotionFactory","$state","promoDetails","rowColorsGuests","checkoutService","bookingFactory","clientListFactory","msgService","convertMMtoDDHHMM","guestFilterFactory","emplFactory","textConsts","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.showGuests=!1,a.message=l.getMsg("loadingInProgress");var r,s;a.showAddGuestModal=!0,a.showAddGroupTable=!1,a.showChangeButton=!0,a.showCloseButton=!0,a.showAddGroupModule=!0,a.newGuests=[];var t=p.getConstValueByName("companiesMaxNum");a.companies=[];for(var u=0;t>u;u++)a.companies[u]=u+1;var v,w,x;a.promotions=[],e.query(function(d){a.promotions=d,s=a.promotions.length,b.query(function(b){a.guests=b,r=a.guests.length,q.get(function(b){w=b,x=new Date(w.currentDateTime),a.currentTimeToShow=x,a.guests=c.modifyGuestArr(a.guests,a.promotions,x),a.outStatNow=c.computeGuestStat(a.guests),a.showGuests=!0},function(b){x=new Date,a.currentTimeToShow=x,a.guests=c.modifyGuestArr(a.guests,a.promotions,x),a.outStatNow=c.computeGuestStat(a.guests),a.showGuests=!0,console.log("serverTimeFactory: "+l.getMsg("cannotQueryData"))})},function(b){a.message=l.getMsg("cannotQueryData")+b.status+" "+b.statusText})},function(a){console.log("activePromotionFactory: "+l.getMsg("cannotQueryData"))}),a.employees=[],o.query(function(b){a.employees=b},function(b){a.message=l.getMsg("cannotQueryData")+b.status+" "+b.statusText,window.alert("emplFactory: "+l.getMsg("cannotQueryData"))}),a.getPromoNameById=function(b){var c;return c=g.getNameById(b,a.promotions)},a.setRowBackgroud=function(a,b,c){var d;return d=h.setRowColor(a,b,c)},a.removePromoIfFree=function(a,b){var c;return c=a?null:b},a.disableIsFreeAD=[],a.disablePromoSelectAD=[],a.disableIsFreeED=!1,a.disablePromoSelectED=!0,a.changeIsFreeFlagByPromo=function(b,d,e){var f=!1,g=c.isSelectedPromoBirthday(b,a.promotions);return g?("AD"==d?(a.disableIsFreeAD[e]=!0,a.disablePromoSelectAD[e]=!1):"ED"==d&&(a.disableIsFreeED=!0,a.disablePromoSelectED=!1),f=!0):("AD"==d?(a.disableIsFreeAD[e]=!1,a.disablePromoSelectAD[e]=!0):"ED"==d&&(a.disableIsFreeED=!1,a.disablePromoSelectED=!0),f=!1),f},a.changeDefCompanyN=function(a){v=a},a.addOneGuestToGroup=function(){var c=a.newGuests.length;a.newGuests.push(new b),a.newGuests[c].guestIndex=c,a.newGuests[c].companyN=v,a.disableIsFreeAD.push(!1),a.disablePromoSelectAD.push(!0)},a.fillGroupInfo=function(){a.addOneGuestToGroup(),a.showAddGroupTable=!0,a.showAddGuestModal=!1,a.showChangeButton=!1,a.showCloseButton=!1},a.cancelFillGroupInfo=function(){a.showAddGroupTable=!a.showAddGroupTable,a.showAddGuestModal=!a.showAddGuestModal,a.showChangeButton=!a.showChangeButton,a.showCloseButton=!a.showCloseButton,a.newGuests=[],a.disableIsFreeAD=[],a.disablePromoSelectAD=[],v=""},a.removeOneGuestFromGroup=function(b){if(a.newGuests.length>1){a.disableIsFreeAD.splice(b,1),a.disablePromoSelectAD.splice(b,1),a.newGuests.splice(b,1);for(var c=0;c<a.newGuests.length;c++)a.newGuests[c].guestIndex=c}else window.alert(l.getMsg("doNotRemoveFrstRow"))},a.saveNewGuestToDB=function(d,e){e.arrivalTime=d,e=c.actualizateGuest(e,a.promotions),b.create(e,function(){a.newGuest={},a.showAddGuestModel=!a.showAddGuestModel,f.reload()},function(){window.alert(l.getMsg("cannotSaveRecord"))})},a.newGuest=new b,a.addGuest=function(b){var c,d;q.get(function(e){d=e,c=d.currentDateTime,c=new Date(d.currentDateTime),a.saveNewGuestToDB(c,b)},function(d){c=new Date,console.log("serverTimeFactory: "+l.getMsg("cannotQueryData")),a.saveNewGuestToDB(c,b)})},a.putGroupIntoDB=function(){for(var b=!0,c=a.newGuests.length,d=0;c>d;d++)b=void 0!=a.newGuests[d].name?b&&!0:b&&!1;if(b)for(d=0;c>d;d++)a.addGuest(a.newGuests[d]);else window.alert(l.getMsg("needNamesForAllGuests"))},a.guestsToCheckout=[],a.showCheckoutModal=function(){for(var b,c,d=!1,e=0;r>e;e++)d=d||a.guests[e].isChecked,a.guests[e].isChecked&&a.guestsToCheckout.push(a.guests[e]);d?q.get(function(d){c=d,b=c.currentDateTime,i.saveArr(a.guestsToCheckout,b),f.go("Modal.confirmClose")},function(c){b=new Date,console.log("serverTimeFactory: "+l.getMsg("cannotQueryData")),i.saveArr(a.guestsToCheckout,b),f.go("Modal.confirmClose")}):window.alert(l.getMsg("selectGuestToClose"))},a.guestToEdit={},a.showEditGuestModal=!1,a.cancelAddingGuest=function(){a.newGuest={}},a.editGuests=function(){for(var b=!1,d=0,e=0;r>e;e++)b=b||a.guests[e].isChecked,a.guests[e].isChecked&&(d++,a.guestToEdit=a.guests[e]);var f;if(b)if(1==d){a.showCloseButton=!1,a.showAddGroupModule=!1,a.showChangeButton=!1,a.showAddGuestModal=!1,f=c.isSelectedPromoBirthday(a.guestToEdit.promotion,a.promotions),f?(a.disablePromoSelectED=!1,a.disableIsFreeED=!0):(a.disablePromoSelectED=!0,a.disableIsFreeED=!1),a.showEditGuestModal=!0;for(var g=0;r>g;g++)a.guests[g].isChecked=!1}else window.alert(l.getMsg("selectJustOneRow"));else window.alert(l.getMsg("selectTheRowToChange"))},a.postChangesToGuest=function(){a.guestToEdit=c.actualizateGuest(a.guestToEdit,a.promotions),b.update({id:a.guestToEdit.id},a.guestToEdit,function(){f.reload()},function(){window.alert(l.getMsg("cannotUpdageRecord"))}),a.showAddGuestModal=!0,a.showAddGroupModule=!0,a.showCloseButton=!0,a.showChangeButton=!0},a.cancelEditingGuest=function(){a.guestToEdit={},a.showEditGuestModal=!1,a.showAddGuestModal=!0,a.showChangeButton=!0,f.reload()},a.convertMinutes=function(a){var b=m.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=n.searchGuestNameAndCompany(b,a.search)},a.computeSearchTotals=function(b){var c=[];return b.length>0&&(c=n.computeSearchTotals(b,a.guests)),c},a.changeEmplIsDir=function(b){return c.changeEmplIsDir(b,a.employees)},a.changeEmplName=function(b){return c.changeEmplName(b,a.employees)}}]),angular.module("timeclubAngularApp").controller("LoginCtrl",["$scope","$state","authService","$location","$rootScope","roleFactory","roleMappingFactory","roleDetails","staffFactory","userDetails","localStorageService","msgService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.login=function(){c.login(this.username,this.password).then(function(b){e.currentUserId=b.userId,f.query(function(b){a.roles=b,g.query(function(b){a.roleMapping=b,e.currentUserRole=h.getRoleDetailsByUserId(e.currentUserId,a.roleMapping,a.roles).roleName,e.currentUserRole==e.adminRoleName?e.isAdmin=!0:e.isAdmin=!1,i.query(function(b){a.staffs=b,e.currentUserName=j.getUserNameByUserId(e.currentUserId,a.staffs),k.clearAll(),k.isSupported&&(k.set("currentUserId",e.currentUserId),k.set("currentUserName",e.currentUserName),k.set("currentUserRole",e.currentUserRole),k.set("isAdmin",e.isAdmin)),d.path("/")},function(a){window.alert("staffFactory: "+l.getMsg("cannotQueryData"))})},function(a){console.log("roleMappingFactory: "+l.getMsg("cannotQueryData"))})},function(a){console.log("roleFactory: "+l.getMsg("cannotQueryData"))})},function(a){window.alert(l.getMsg("cannotLogin"))})},a.cancelLogin=function(){a.username="",a.password=""}}]),angular.module("timeclubAngularApp").controller("ReservationCtrl",["$scope","bookingFactory","$state","rowColorsBookings","$rootScope","clientListFactory","bookingFactoryToday","bookingFactoryTodayAndFuture","msgService","textConsts","guestCompute","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){a.showInfo=!1,a.showAddBookingForm=!0,a.showSearchForm=!0,a.showEditBookingForm=!1,a.phoneMask=j.getPhoneMask(),a.statuses=j.getBookingStatuses();var m;a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0;var n;l.get(function(b){n=b,a.startDate=new Date(n.currentDateTime),a.computeDates()},function(b){a.startDate=new Date,console.log("serverTimeFactory: "+i.getMsg("cannotQueryData")),a.computeDates()}),a.computeDates=function(){a.startDate.setHours(0,0,0,0),a.endDate=new Date(a.startDate.getFullYear(),a.startDate.getMonth(),a.startDate.getDate()+1,0,0,0,0),a.showTodayBookings(),a.pastYearDates=k.computeDatesPastYear(a.startDate),a.startDatePY=a.pastYearDates.startDate,a.endDatePY=a.pastYearDates.endDate},a.showTodayBookings=function(){g.query({start:a.startDate,end:a.endDate},function(b){a.bookings=b,m=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!1,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0},function(b){a.message=i.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.showTodayAndFutureBookings=function(){h.query({start:a.startDate},function(b){a.bookings=b,m=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!1,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0},function(b){a.message=i.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.showAllBookings=function(){b.query(function(b){a.bookings=b,m=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!1,a.PastYearBookingsBtn=!0},function(b){a.message=i.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.showPastYearBookings=function(){g.query({start:a.startDatePY,end:a.endDatePY},function(b){a.bookings=b,m=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!1},function(b){a.message=i.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.setRowBackgroud=function(b){var c;return c=d.setRowColor(b,a.statuses)},a.newBooking=new b,a.addBooking=function(b){var c,d;null==b.date||void 0==b.date?window.alert(i.getMsg("needDateTimeBooking")):l.get(function(e){c=e,d=new Date(c.currentDateTime),b.date>d?a.postBookingToDB(b,d):window.alert(i.getMsg("noBookingInPast"))},function(c){d=new Date,console.log("serverTimeFactory: "+i.getMsg("cannotQueryData")),b.date>d?a.postBookingToDB(b,d):window.alert(i.getMsg("noBookingInPast"))})},a.postBookingToDB=function(d,g){d.status=a.statuses[0],b.create(d,function(){a.newBooking={},f.query(function(a){for(var b=a,c=!0,h=0;h<b.length;h++)d.phone==b[h].phone&&(c=!1);if(c){var j=new f;j.phone=d.phone,j.name=d.name,j.sysComment="клиент создан при создании брони  "+g+" пользователем "+e.currentUserName,f.create(j,function(){console.log("Клиент из брони: "+i.getMsg("recordCreated")),j={}},function(){console.log(i.getMsg("cannotSaveRecord"))})}else console.log(i.getMsg("bookingPhoneNotUnique"))},function(b){a.message=i.getMsg("cannotQueryData")+b.status+" "+b.statusText}),c.reload()},function(){window.alert(i.getMsg("cannotSaveRecord"))})},a.cancelAddingBooking=function(){a.newBooking={}},a.checkBookingStatusBeforeUpdate=function(b,c){var d=!0;return b==c?d=!1:(b!=a.statuses[1]||c!=a.statuses[2]&&c!=a.statuses[3]||(d=!1),b==a.statuses[2]&&c==a.statuses[3]&&(d=!1),b==a.statuses[3]&&c==a.statuses[2]&&(d=!1)),d},a.showModifyBookingForm=function(){for(var b,c=!1,d=0,e=0;m>e;e++)c=c||a.bookings[e].isSelected,a.bookings[e].isSelected&&(d++,a.modifiedBooking=a.bookings[e],b=e);c?1==d?a.bookings[b].status==a.statuses[0]?(a.showEditBookingForm=!0,a.showAddBookingForm=!1,a.showSearchForm=!1,a.bookings[b].isSelected=!1):window.alert(i.getMsg("cannotUpdateThisBooking")):window.alert(i.getMsg("selectJustOneRow")):window.alert(i.getMsg("selectTheRowToChange"))},a.postChangesToBooking=function(b){var c,d;null==b.date||void 0==b.date?window.alert(i.getMsg("needDateTimeBooking")):l.get(function(e){c=e,d=new Date(c.currentDateTime),b.date>d?a.postChangesOfBookingToDB(b):window.alert(i.getMsg("noBookingInPast"))},function(c){d=new Date,console.log("serverTimeFactory: "+i.getMsg("cannotQueryData")),b.date>d?a.postChangesOfBookingToDB(b):window.alert(i.getMsg("noBookingInPast"))})},a.postChangesOfBookingToDB=function(d){b.update({id:a.modifiedBooking.id},a.modifiedBooking,function(){c.reload()},function(){window.alert(i.getMsg("cannotUpdageRecord"))}),a.showEditBookingForm=!1,a.showAddBookingForm=!0,a.showSearchForm=!0},a.cancelEditingBooking=function(b){a.showEditBookingForm=!1,a.showAddBookingForm=!0,a.showSearchForm=!0,a.bookings[bookingSelectedN].isSelected=!0,a.modifiedBooking={},c.reload()},a.changeBookingStatus=function(d){var e,f,g=!1,h=0;for(e=0;m>e;e++)g=g||a.bookings[e].isSelected,a.bookings[e].isSelected&&(h++,f=e);if(g)if(1==h){var j=!1;j=a.checkBookingStatusBeforeUpdate(a.bookings[f].status,d),j?(a.bookings[f].isSelected=!1,a.bookings[f].status=d,b.update({id:a.bookings[f].id},a.bookings[f],function(){c.reload()},function(){window.alert(i.getMsg("cannotUpdageRecord"))})):window.alert(i.getMsg("bookingWrongStatus")+a.bookings[f].status+" на "+d)}else window.alert(i.getMsg("selectJustOneRow"));else window.alert(i.getMsg("selectTheRowToChange"))},a.hourStep=j.getCalendarSetting("hourStep"),a.minuteStep=j.getCalendarSetting("minuteStep"),a.format=j.getCalendarSetting("format"),a.dateOptions={showWeeks:j.getCalendarSetting("showWeeks"),startingDay:j.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("CheckoutDetailsCtrl",["$scope","checkoutFactory","$state","$interval","msgService","convertMMtoDDHHMM",function(a,b,c,d,e,f){a.showCheckouts=function(){var c;a.showInfo=!1,b.query(function(b){a.guestsToCheckout=b,c=a.guestsToCheckout.length,c>0&&(a.showInfo=!0),a.totalN=c,a.amountCheckout=0;for(var d=0;c>d;d++)a.amountCheckout=a.amountCheckout+a.guestsToCheckout[d].amount},function(b){a.message=e.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.convertMinutes=function(a){var b=f.convertMinutes(a);return b},d(function(){a.showCheckouts()},7e3)}]),angular.module("timeclubAngularApp").controller("DashboardCtrl",["$scope","guestFactory","guestCompute","clientFactoryFiltered","promotionFactory","$rootScope","msgService","serverTimeFactory",function(a,b,c,d,e,f,g,h){a.showInfo=!1,a.message=g.getMsg("loadingInProgress"),a.guestsModified=[];var i;h.get(function(b){i=b,a.startDateToday=new Date(i.currentDateTime),a.endDate=a.startDateToday,a.doDBFetch()},function(b){a.startDateToday=new Date,a.endDate=a.startDateToday,a.doDBFetch(),console.log("serverTimeFactory: "+g.getMsg("cannotQueryData"))}),a.doDBFetch=function(){a.startDate=c.computeStartDateThisDay(a.startDateToday,f.currentUserRole),a.startDate2=c.computeStartDateThisMonth(a.startDateToday),b.query(function(b){a.guests=b,a.showInfo=!0,e.query(function(b){a.promotions=b,a.guestsModified=c.modifyGuestArr(a.guests,a.promotions,a.endDate),a.outStatNow=c.computeGuestStat(a.guestsModified)},function(a){console.log("promotionFactory: "+g.getMsg("cannotQueryData"))})},function(b){a.message=b.status+" "+b.statusText,window.alert(g.getMsg("cannotQueryData")+a.message)}),d.query({start:a.startDate,end:a.endDate},function(b){a.clients=b,a.outStatToday=c.computeGuestStat(a.clients)},function(b){a.message=g.getMsg("cannotQueryData")+b.status+" "+b.statusText}),d.query({start:a.startDate2,end:a.endDate},function(b){a.clients2=b,a.outStatMonth=c.computeGuestStat(a.clients2)},function(b){a.message=g.getMsg("cannotQueryData")+b.status+" "+b.statusText})}}]),angular.module("timeclubAngularApp").controller("HistoryCtrl",["$scope","clientFactoryFiltered","guestCompute","promotionFactory","promoDetails","rowColorsGuests","$state","clientFactory","$rootScope","activePromotionFactory","msgService","textConsts","convertMMtoDDHHMM","guestFactory","guestFilterFactory","emplFactory","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.showClients=!1,a.message=k.getMsg("loadingInProgress");var r=l.getConstValueByName("companiesMaxNum");a.companies=[];for(var s=0;r>s;s++)a.companies[s]=s+1;var t;q.get(function(b){t=b,a.startDateToday=new Date(t.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=c.computeStartDateThisDay(a.startDateToday,i.currentUserRole),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(b){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=c.computeStartDateThisDay(a.startDateToday,i.currentUserRole),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+k.getMsg("cannotQueryData"))}),a.promotions=[],a.activePromotions=[],d.query(function(b){a.promotions=b},function(a){console.log("promotionFactory: "+k.getMsg("cannotQueryData"))}),j.query(function(b){a.activePromotions=b},function(a){console.log("activePromotionFactory: "+k.getMsg("cannotQueryData"))}),a.employees=[],p.query(function(b){a.employees=b},function(b){a.message=k.getMsg("cannotQueryData")+b.status+" "+b.statusText,window.alert("emplFactory: "+k.getMsg("cannotQueryData"))}),a.getPromoNameById=function(b){var c;return c=e.getNameById(b,a.promotions)},a.setRowBackgroud=function(a,b,c){var d;return d=f.setRowColor(a,b,c)},a.disableIsFreeED=!1,a.disablePromoSelectED=!0,a.changeIsFreeFlagByPromo=function(b,d,e){var f=!1,g=c.isSelectedPromoBirthday(b,a.promotions);return g?(a.disableIsFreeED=!0,a.disablePromoSelectED=!1,f=!0):(a.disableIsFreeED=!1,a.disablePromoSelectED=!0,f=!1),f},a.removePromoIfFree=function(a,b){var c;return c=a?null:b};var u;a.getDatesAndFetchClients=function(d,e){d>e?window.alert(k.getMsg("validateDatesBegEnd")):b.query({start:d,end:e},function(b){a.clients=b,u=a.clients.length,a.showClients=!0,a.search="",a.outStat=c.computeGuestStat(a.clients)},function(b){a.message=k.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.isCurrentUserAnAdminUser=i.isAdmin,a.showEditGuestModal=!1,a.showChangeButton=!0,a.guestToBackToMain={},a.backToMain=function(){if(i.isAdmin){var b,c,d,e=!1,f=0;for(b=0;u>b;b++)e=e||a.clients[b].isChecked,a.clients[b].isChecked&&(f++,c=b);e?1==f?(a.showChangeButton=!1,a.clients[c].isChecked=!1,a.guestToBackToMain=a.clients[c],a.guestToBackToMain.timeInClub=0,a.guestToBackToMain.amount=0,a.guestToBackToMain.checkoutTime=null,d=window.confirm(k.getMsg("confirmBackToMain")),d?n.create(a.guestToBackToMain,function(){h.remove({id:a.guestToBackToMain.id},function(){a.guestToBackToMain={},g.reload(),a.showChangeButton=!0},function(){window.alert(k.getMsg("cannotDeleteRecord"))})},function(){window.alert(k.getMsg("cannotSaveRecord"))}):a.cancelBackToMain()):window.alert(k.getMsg("selectJustOneRow")):window.alert(k.getMsg("selectTheRowToChange"))}else window.alert(k.getMsg("adminRoleNeeded"))},a.cancelBackToMain=function(){a.guestToBackToMain={},a.showChangeButton=!0},a.guestToEdit={},a.editGuests=function(){if(i.isAdmin){var b,d,e=!1,f=0;for(b=0;u>b;b++)e=e||a.clients[b].isChecked,a.clients[b].isChecked&&(f++,d=b);var g;e?1==f?(a.showChangeButton=!1,a.clients[d].isChecked=!1,a.guestToEdit=a.clients[d],g=c.isSelectedPromoBirthday(a.guestToEdit.promotion,a.promotions),g?(a.disablePromoSelectED=!1,a.disableIsFreeED=!0):(a.disablePromoSelectED=!0,a.disableIsFreeED=!1),a.showEditGuestModal=!0):window.alert(k.getMsg("selectJustOneRow")):window.alert(k.getMsg("selectTheRowToChange"))}else window.alert(k.getMsg("adminRoleNeeded"))},a.postChangesToGuest=function(){var b,c;q.get(function(d){b=d,c=new Date(b.currentDateTime),a.postChangesToGuestToDB(c)},function(b){c=new Date,a.postChangesToGuestToDB(c),console.log("serverTimeFactory: "+k.getMsg("cannotQueryData"))})},a.postChangesToGuestToDB=function(b){var d=Math.abs(Date.parse(b)-Date.parse(a.guestToEdit.checkoutTime)),e=!1,f=[];if(d<=i.oneDayInMSec&&(e=!0),e){a.guestToEdit=c.actualizateGuest(a.guestToEdit,a.promotions),f[0]=a.guestToEdit,f=c.modifyGuestArr(f,a.promotions,b);for(var j=0;j<f.length;j++)a.newClient=new h,a.newClient=f[0],h.update({id:a.newClient.id},a.newClient,function(){g.reload()},function(){window.alert(k.getMsg("cannotUpdageRecord"))});a.showChangeButton=!0}else window.alert(k.getMsg("cannotChangeOldHisotory"))},a.cancelEditingGuest=function(){a.guestToEdit={},a.selectedPromoEdit={},a.showEditGuestModal=!1,a.showChangeButton=!0,g.reload()},a.changeEmplIsDir=function(b){return c.changeEmplIsDir(b,a.employees)},a.changeEmplName=function(b){return c.changeEmplName(b,a.employees)},a.convertMinutes=function(a){var b=m.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=o.searchGuestNameAndCompany(b,a.search)},a.computeSearchTotals=function(b){var c=[];return b.length>0&&(c=o.computeSearchTotals(b,a.clients)),c},a.hourStep=l.getCalendarSetting("hourStep"),a.minuteStep=l.getCalendarSetting("minuteStep"),a.format=l.getCalendarSetting("format"),a.dateOptions={showWeeks:l.getCalendarSetting("showWeeks"),startingDay:l.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("StatCtrl",["$scope","guestCompute","clientFactoryFiltered","promotionFactory","$rootScope","msgService","textConsts","serverTimeFactory",function(a,b,c,d,e,f,g,h){a.showInfo=!1,a.showMessage=!1,a.message=f.getMsg("loadingInProgress");var i,j,k,l,m,n,o;h.get(function(c){o=c,a.startDateToday=new Date(o.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(c){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+f.getMsg("cannotQueryData"))}),a.getDatesAndFetchClients=function(e,g){e>g?window.alert(f.getMsg("validateDatesBegEnd")):(a.showMessage=!0,d.query(function(d){a.promotions=d,c.query({start:a.startDate,end:a.endDate},function(c){a.clients=c,a.outStat=b.computeClientStat(a.clients,a.promotions),a.showMessage=!1,a.showInfo=!0;for(var d=0;d<a.outStat.length;d++)"------бесплатные"==a.outStat[d].category&&(i=a.outStat[d].n,l=a.outStat[d].sum),"--------стандарт (10 тг. минута)"==a.outStat[d].category&&(j=a.outStat[d].n,m=a.outStat[d].sum),"--------акции"==a.outStat[d].category&&(k=a.outStat[d].n,n=a.outStat[d].sum);a.chartGuestsOptions={data:[{freeGuests:i,paidGuests:j,promoGuests:k}],dimensions:{freeGuests:{name:"Бесплатные гости",type:"bar"},paidGuests:{name:"Платные гости",type:"bar"},promoGuests:{name:"По акции",type:"bar"}}},a.chartAmountsOptions={data:[{freeGuests:l,paidGuests:m,promoGuests:n}],dimensions:{freeGuests:{name:"Бесплатные гости",type:"bar"},paidGuests:{name:"Платные гости",type:"bar"},promoGuests:{name:"По акции",type:"bar"}}}},function(b){a.message=f.getMsg("cannotQueryData")+b.status+" "+b.statusText})},function(a){console.log("promotionFactory: "+f.getMsg("cannotQueryData"))}))},a.hourStep=g.getCalendarSetting("hourStep"),a.minuteStep=g.getCalendarSetting("minuteStep"),a.format=g.getCalendarSetting("format"),a.dateOptions={showWeeks:g.getCalendarSetting("showWeeks"),startingDay:g.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("PreferencesCtrl",["$scope","promotionFactory","$state","authService","staffFactory","roleFactory","roleMappingFactory","$rootScope","roleDetails","msgService","textConsts","emplFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){a.showInfo=!1,a.showEmps=!1,a.defaultRoleForNewUsers=k.getDefaultRoleForNewUsers(),a.message=j.getMsg("cannotQueryData"),a.promotionTypes=k.getPromotionTypes(),a.consts=k.getConstArr(),a.showChangeButton=!0,l.query(function(b){a.employees=b,a.showEmps=!0},function(b){a.message=j.getMsg("cannotQueryData")+b.status+" "+b.statusText,window.alert("emplFactory: "+j.getMsg("cannotQueryData"))}),a.showPromos=!1,b.query(function(b){a.promotions=b,a.showPromos=!0},function(b){a.message=j.getMsg("cannotQueryData")+b.status+" "+b.statusText,window.alert("promotionFactory: "+j.getMsg("cannotQueryData"))}),a.showUsers=!1,f.query(function(b){a.roles=b;for(var c=0;c<a.roles.length;c++)a.roles[c].name==a.defaultRoleForNewUsers&&(a.selectedRole=a.roles[c]);g.query(function(b){a.roleMapping=b,e.query(function(b){a.staffs=b,a.showUsers=!0},function(a){window.alert("staffFactory: "+j.getMsg("cannotQueryData"))})},function(a){window.alert("roleMappingFactory: "+j.getMsg("cannotQueryData"))})},function(a){window.alert("roleFactory: "+j.getMsg("cannotQueryData"))}),a.newPromotion=new b,a.addPromotion=function(){if(h.isAdmin){a.newPromotion.isActive=!0;for(var d=0;d<a.promotionTypes.length;d++)a.promotionTypes[d].desc==a.newPromotion.typeDesc&&(a.newPromotion.type=a.promotionTypes[d].type);b.create(a.newPromotion,function(){a.newPromotion={},a.showAddPromotionModal=!a.showAddPromotionModal},function(){window.alert("promotionFactory: "+j.getMsg("cannotSaveRecord"))}),c.reload()}else a.cancelAddingPromotion(),window.alert(j.getMsg("adminRoleNeeded"))},a.toggleAddPromotionModal=function(){a.showAddPromotionModal=!a.showAddPromotionModal},a.cancelAddingPromotion=function(){a.newPromotion={},a.showAddPromotionModal=!a.showAddPromotionModal},a.ToggleIsActiveFlagPromotion=function(){a.promoSelected=!1;var d;d=a.promotions.length;for(var e=0;d>e;e++)a.promoSelected=a.promoSelected||a.promotions[e].isSelected;if(a.promoSelected)if(h.isAdmin)for(e=0;d>e;e++)a.promotions[e].isSelected&&(a.promotions[e].isActive=!a.promotions[e].isActive,a.promotions[e].isSelected=!a.promotions[e].isSelected,b.update({id:a.promotions[e].id},a.promotions[e],function(){c.reload()},function(){c.reload(),console.log(response.status+"; "+response.statusText),window.alert("promotionFactory: "+j.getMsg("cannotUpdageRecord"))}));else window.alert(j.getMsg("adminRoleNeeded"));else window.alert(j.getMsg("selectTheRowToChange"))},a.selectedRole={},a.newRoleMapping=new g,a.register=function(){if(h.isAdmin){var b=new Date;this.password===this.passwordConf?d.register(this.email,this.password,b).then(function(b){a.newRoleMapping.principalType="USER",a.newRoleMapping.principalId=b.id,a.newRoleMapping.roleId=a.selectedRole.id,g.create(a.newRoleMapping,function(){a.newRoleMapping={}},function(){window.alert("roleMappingFactory: "+j.getMsg("cannotSaveRecord"))}),a.showAddUserModal=!a.showAddUserModal,c.reload()},function(a){console.log(a),window.alert("authService: "+j.getMsg("cannotSaveRecord"))}):(this.passwordConf="",window.alert(j.getMsg("passwordIsNotConfirmed")))}else a.cancelAddingUser(),window.alert(j.getMsg("adminRoleNeeded"))},a.showAddEmployeeModal=!1,a.toggleAddEmployeeModal=function(){a.showAddEmployeeModal=!a.showAddEmployeeModal},a.cancelAddingEmployee=function(){a.newEmployee={},a.showAddEmployeeModal=!a.showAddEmployeeModal},a.newEmpl={},a.addNewEmpl=function(){h.isAdmin?(l.create(a.newEmpl,function(){a.newEmpl={},a.showAddEmployeeModal=!a.showAddEmployeeModal},function(){window.alert("emplFactory: "+j.getMsg("cannotSaveRecord"))}),c.reload()):(a.cancelAddingEmployee(),window.alert(j.getMsg("adminRoleNeeded")))},a.deleteEmpl=function(){if(h.isAdmin){a.emplSelected=!1;var b,d;b=a.employees.length;for(var e=0;b>e;e++)a.emplSelected=a.emplSelected||a.employees[e].isSelected;if(a.emplSelected)if(1==window.confirm("Подтвердите удаление"))for(e=0;b>e;e++)a.employees[e].isSelected&&(d=a.employees[e].id,l.remove({id:d},function(){c.reload()},function(){window.alert("staffFactory: "+j.getMsg("cannotDeleteRecord"))}));else for(e=0;b>e;e++)a.employees[e].isSelected=!1;else window.alert(j.getMsg("selectTheRowToDelete"))}else window.alert(j.getMsg("adminRoleNeeded"))},a.showAddUserModal=!1,a.toggleAddUserModal=function(){a.showAddUserModal=!a.showAddUserModal},a.cancelAddingUser=function(){a.newUser={},a.showAddUserModal=!a.showAddUserModal},a.DeleteUser=function(){if(h.isAdmin){a.userSelected=!1;var b,d;b=a.staffs.length;for(var f={},k=0;b>k;k++)a.userSelected=a.userSelected||a.staffs[k].isSelected;if(a.userSelected)if(1==window.confirm("Подтвердите удаление"))for(k=0;b>k;k++)a.staffs[k].isSelected&&(d=a.staffs[k].id,f=i.getRoleDetailsByUserId(d,a.roleMapping,a.roles),f.roleName==h.adminRoleName?window.alert(j.getMsg("cannotDeleteAdminUser")):e.remove({id:d},function(){""!=f.roleMappingId||"undefined"!=f.roleMappingId?g.remove({id:f.roleMappingId},function(){},function(){window.alert("roleMappingFactory: "+j.getMsg("cannotDeleteRecord"))}):c.reload(),c.reload()},function(){window.alert("staffFactory: "+j.getMsg("cannotDeleteRecord"))}));else for(k=0;b>k;k++)a.staffs[k].isSelected=!1;else window.alert(j.getMsg("selectTheRowToDelete"))}else window.alert(j.getMsg("adminRoleNeeded"))},a.ShowUserRole=function(b){return i.getRoleDetailsByUserId(b,a.roleMapping,a.roles).roleName}}]),angular.module("timeclubAngularApp").controller("HeaderCtrl",["$scope","$state","authService","$location","localStorageService","$rootScope",function(a,b,c,d,e,f){a.logout=function(){c.logout().then(function(a){d.path("/login"),e.clearAll()},function(a){console.log(a)})},a.stateReload=function(){b.reload()},a.isCurrentUserAnAdmin=f.isAdmin,a.isCollapsed=!0,a.collapse=function(){a.isCollapsed=!a.isCollapsed}}]),angular.module("timeclubAngularApp").controller("CheckoutCtrl",["$scope","checkoutService","clientFactory","guestFactory","guestCompute","promotionFactory","$state","$timeout","checkoutFactory","msgService","convertMMtoDDHHMM",function(a,b,c,d,e,f,g,h,i,j,k){var l,m;a.isPaidButtonActive=!1,f.query(function(c){
a.deleteCheckouts(),a.promotions=c,a.guestsToCheckout=b.fetchArr(),m=b.fetchDateTime(),l=a.guestsToCheckout.length,a.totalN=l,a.guestsToCheckout=e.modifyGuestArr(a.guestsToCheckout,a.promotions,m),a.amountCheckout=0;for(var d=0;l>d;d++)a.amountCheckout=a.amountCheckout+a.guestsToCheckout[d].amount,a.guestsToCheckout[d].checkoutTime=m;for(var f=new i,g=0;l>g;g++)f={},f.name=a.guestsToCheckout[g].name,f.promotion=a.guestsToCheckout[g].promotion,f.arrivalTime=a.guestsToCheckout[g].arrivalTime,f.checkoutTime=a.guestsToCheckout[g].checkoutTime,f.timeInClub=a.guestsToCheckout[g].timeInClub,f.amount=a.guestsToCheckout[g].amount,f.isFree=a.guestsToCheckout[g].isFree,f.isEmployee=a.guestsToCheckout[g].isEmployee,i.create(f,function(){f={}},function(){console.log("checkoutFactory: "+j.getMsg("cannotSaveRecord"))})},function(a){console.log("promotionFactory: "+j.getMsg("cannotQueryData"))}),a.deleteCheckouts=function(){i.query(function(a){for(var b=a,c=0;c<b.length;c++)i.remove({id:b[c].id},function(){},function(){console.log("checkoutFactory: "+j.getMsg("cannotDeleteRecord"))})},function(){console.log("checkoutFactory: "+j.getMsg("cannotQueryData"))})},a.checkoutGuests=function(){for(var b=0;l>b;b++)a.guestsToCheckout[b].isActive=!1,a.guestsToCheckout[b].isChecked=!1,a.newClient=new c,a.newClient=a.guestsToCheckout[b],c.create(a.newClient,function(){},function(){window.alert("clientFactory: "+j.getMsg("cannotSaveRecord"))}),d.remove({id:a.guestsToCheckout[b].id},function(){},function(){window.alert("guestFactory: "+j.getMsg("cannotDeleteRecord"))});a.isPaidButtonActive=!0},a.cancleCheckoutGuests=function(){a.deleteCheckouts(),g.go("app",{},{reload:!0})},a.closeCheckoutWindow=function(){a.deleteCheckouts(),g.go("app",{},{reload:!0})},a.convertMinutes=function(a){var b=k.convertMinutes(a);return b}}]),angular.module("timeclubAngularApp").controller("ClientsCtrl",["$scope","clientListFactory","$state","$rootScope","msgService","textConsts",function(a,b,c,d,e,f){a.showInfo=!1,a.message=e.getMsg("loadingInProgress"),a.phoneMask=f.getPhoneMask();var g;b.query(function(b){a.clientlist=b,g=a.clientlist.length,a.showInfo=!0},function(b){a.message=e.getMsg("cannotQueryData")+b.status+" "+b.statusText}),a.newClient=new b,a.addClient=function(f,h){var i=!1;if(f.phone.match(/^\d+$/)&&10==f.phone.length&&(i=!0),i){for(var j=!0,k=new Date,l=0;g>l;l++)f.phone==a.clientlist[l].phone&&(j=j&&!1);j?(h?f.sysComment="добавлено "+k+" пользователем "+d.currentUserName:f.sysComment="загружено из файла "+k+" пользователем "+d.currentUserName,b.create(f,function(){h&&(a.newClient={},c.reload())},function(){h?window.alert(e.getMsg("cannotSaveRecord")):console.log("clientListFactory: "+e.getMsg("cannotSaveRecord"))})):h?window.alert(e.getMsg("phoneNotUnique")):console.log("загрузка из excel файла: "+e.getMsg("phoneNotUnique"))}else h?window.alert(e.getMsg("phoneWrongFormat")):console.log("загрузка из excel файла: "+e.getMsg("phoneWrongFormat"))},a.cancelAddingClient=function(){a.newClient={}},a.DeleteClient=function(f){if(d.isAdmin){for(var h,i=!1,j=0;g>j;j++)i=i||a.clientlist[j].isSelected;if(i)if(1==window.confirm("Подтвердите удаление"))for(j=0;g>j;j++)a.clientlist[j].isSelected&&(h=a.clientlist[j].id,b.remove({id:h},function(){c.reload()},function(){window.alert(e.getMsg("cannotDeleteRecord"))}));else for(j=0;g>j;j++)a.clientlist[j].isSelected=!1;else window.alert(e.getMsg("selectTheRowToDelete"))}else window.alert(e.getMsg("adminRoleNeeded"))},a.downloadExampleXLS=function(){function a(a,b){b&&(a+=1462);var c=Date.parse(a);return(c-new Date(Date.UTC(1899,11,30)))/864e5}function b(b,c){for(var d={},e={s:{c:1e7,r:1e7},e:{c:0,r:0}},f=0;f!=b.length;++f)for(var g=0;g!=b[f].length;++g){e.s.r>f&&(e.s.r=f),e.s.c>g&&(e.s.c=g),e.e.r<f&&(e.e.r=f),e.e.c<g&&(e.e.c=g);var h={v:b[f][g]};if(null!=h.v){var i=XLSX.utils.encode_cell({c:g,r:f});"number"==typeof h.v?h.t="n":"boolean"==typeof h.v?h.t="b":h.v instanceof Date?(h.t="n",h.z=XLSX.SSF._table[14],h.v=a(h.v)):h.t="s",d[i]=h}}return e.s.c<1e7&&(d["!ref"]=XLSX.utils.encode_range(e)),d}function c(){return this instanceof c?(this.SheetNames=[],void(this.Sheets={})):new c}function d(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}var e=[["phone","name"],[7051881515,"Владимир"],[7774486678,"Иван"],[7051114203]],f="SheetJS",g=new c,h=b(e);g.SheetNames.push(f),g.Sheets[f]=h;var i=XLSX.write(g,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([d(i)],{type:"application/octet-stream"}),"template.xlsx")},a.clientsFromXLSX=[];var h,i=XLSX,j={msg:"xlsx",worker:"./bower_components/js-xlsx/xlsxworker.js"},k=document.getElementById("out"),l=function(){var b=function(a){var b={};return a.SheetNames.forEach(function(c){var d=i.utils.sheet_to_json(a.Sheets[c]);d.length&&(b=d)}),b};return function(c){h=c;var d="",e="";d=b(c),a.clientsFromXLSX=d,e="Выбранный файл содержит "+d.length+" строк (клиентов). Нажмите кнопку Загрузить список из файла для заливки данных о клиентах на сервер.",void 0===k.innerText?k.textContent=e:k.innerText=e,"undefined"!=typeof console&&console.log("output",new Date)}}(),m=function(){var a="undefined"!=typeof FileReader&&(FileReader.prototype||{}).readAsBinaryString,b=("undefined"!=typeof Worker,function(b,c){var d=new Worker(j.worker);d.onmessage=function(a){switch(a.data.t){case"ready":break;case"e":console.error(a.data.d);break;case j.msg:c(JSON.parse(a.data.d))}},d.postMessage({d:b,b:a?"binary":"array"})});return function(a){var c=!0,d=!0,e=a[0],f=new FileReader;f.onload=function(a){"undefined"!=typeof console&&console.log("onload",new Date,c,d);var e=a.target.result;c||(e=new Uint8Array(e)),d?b(e,l):l(i.read(e,{type:c?"binary":"array"}))},c?f.readAsBinaryString(e):f.readAsArrayBuffer(e)}}();!function(){function a(a){m(a.target.files)}var b=document.getElementById("xlf");b.addEventListener&&b.addEventListener("change",a,!1)}(),a.uploadFromXLS=function(){if(a.clientsFromXLSX.length){console.log("start saving clients from XLSX to DB: total "+a.clientsFromXLSX.length+" clients");for(var b=0;b<a.clientsFromXLSX.length;b++)a.addClient(a.clientsFromXLSX[b],!1);c.reload(),window.alert(e.getMsg("clientsUploadCompleted"))}else window.alert(e.getMsg("selectFile"))},a.hourStep=f.getCalendarSetting("hourStep"),a.minuteStep=f.getCalendarSetting("minuteStep"),a.format=f.getCalendarSetting("format"),a.dateOptions={showWeeks:f.getCalendarSetting("showWeeks"),startingDay:f.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").constant("baseURL","http://0.0.0.0:3000/api/").constant("serverTimeURL","http://0.0.0.0:3001/time").factory("serverTimeFactory",["$resource","serverTimeURL",function(a,b){return a(b,{},{get:{method:"GET"}})}]).factory("guestFactory",["$resource","baseURL",function(a,b){return a(b+"guests/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("clientFactory",["$resource","baseURL",function(a,b){return a(b+"clients/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("clientFactoryFiltered",["$resource","baseURL",function(a,b){return a(b+"clients?filter[where][checkoutTime][between][0]=:start&filter[where][checkoutTime][between][1]=:end",{},{query:{method:"GET",isArray:!0}})}]).factory("employeeWagesFactory",["$resource","baseURL",function(a,b){return a(b+"clients?filter[where][checkoutTime][between][0]=:start&filter[where][checkoutTime][between][1]=:end&filter[where][isEmployee]=:emplFlag&filter[where][isDirector]=:dirFlag",{},{query:{method:"GET",isArray:!0}})}]).factory("clientListFactory",["$resource","baseURL",function(a,b){return a(b+"clientlists/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("emplFactory",["$resource","baseURL",function(a,b){return a(b+"employees/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("bookingFactory",["$resource","baseURL",function(a,b){return a(b+"bookings/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("bookingFactoryToday",["$resource","baseURL",function(a,b){return a(b+"bookings?filter[where][date][between][0]=:start&filter[where][date][between][1]=:end",{},{query:{method:"GET",isArray:!0}})}]).factory("bookingFactoryTodayAndFuture",["$resource","baseURL",function(a,b){return a(b+"bookings?filter[where][date][gte]=:start",{},{query:{method:"GET",isArray:!0}})}]).factory("checkoutFactory",["$resource","baseURL",function(a,b){return a(b+"checkouts/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("promotionFactory",["$resource","baseURL",function(a,b){return a(b+"promotions/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("activePromotionFactory",["$resource","baseURL",function(a,b){return a(b+"promotions?filter[where][isActive]=true",{},{query:{method:"GET",isArray:!0}})}]).service("guestCompute",["$rootScope","textConsts",function(a,b){this.modifyGuestArr=function(a,c,d){for(var e=a,f=a.length,g=b.getConstValueByName("pricePerMinute"),h=b.getConstValueByName("maxAmount"),i=0;f>i;i++){var j,k,l,m;if(j=1,null!=e[i].checkoutTime||void 0!=e[i].checkoutTime?e[i].timeInClub=Math.floor(Math.abs(Date.parse(e[i].arrivalTime)-Date.parse(e[i].checkoutTime))/6e4):e[i].timeInClub=Math.floor(Math.abs(Date.parse(e[i].arrivalTime)-Date.parse(d))/6e4),e[i].isFree||e[i].isEmployee)e[i].amount=0;else if(null!=e[i].promotion||void 0!=e[i].promotion){k=0;for(var n=!0;n;)c[k].id==e[i].promotion?(l=c[k].type,m=c[k].value,n=!1):(k++,k>=c.length&&(n=!1));"fixAmount"==l?e[i].amount=m:"fixDiscount"==l?(j=1-m/100,e[i].amount=Math.min(j*g*e[i].timeInClub,j*h)):e[i].amount=Math.min(g*e[i].timeInClub,h)}else e[i].amount=Math.min(g*e[i].timeInClub,h)}return e},this.computeGuestStat=function(a){for(var b=a,c=a.length,d=0,e=0,f=0,g=0,h=0,i=0;c>i;i++)b[i].isEmployee?g++:b[i].isFree?e++:d+=b[i].amount;var j=[];return h=c-g,f=h-e,j.push(c),j.push(g),j.push(h),j.push(f),j.push(e),j.push(d),j},this.computeClientStat=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=a.length,o=[],p=n,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0;for(d=0;d<b.length;d++)b[d].N=0,b[d].Sum=0;for(c=0;n>c;c++){var H=a[c].amount;if(q+=H,a[c].isEmployee)r++,s+=H,a[c].isEmployeeAtWork?(t++,u+=H):(v++,w+=H);else if(x++,y+=H,a[c].isFree)z++,A+=H;else if(B++,C+=H,null==a[c].promotion||void 0==a[c].promotion)D++,E+=H;else for(F++,G+=H,d=0;d<b.length;d++)b[d].id==a[c].promotion&&(b[d].N++,b[d].Sum=b[d].Sum+H)}for(0!=p&&(e=q/p),0!=r&&(f=s/r),0!=t&&(g=u/t),0!=v&&(h=w/v),0!=x&&(i=y/x),0!=z&&(j=A/z),0!=B&&(k=C/B),0!=D&&(l=E/D),0!=F&&(m=G/F),o.push({category:"Всего",n:p,sum:q,av:e}),o.push({category:"----Сотрудники",n:r,sum:s,av:f}),o.push({category:"------в смене",n:t,sum:u,av:g}),o.push({category:"------просто",n:v,sum:w,av:h}),o.push({category:"----Гости",n:x,sum:y,av:i}),o.push({category:"------бесплатные",n:z,sum:A,av:j}),o.push({category:"------платные",n:B,sum:C,av:k}),o.push({category:"--------стандарт (10 тг. минута)",n:D,sum:E,av:l}),o.push({category:"--------акции",n:F,sum:G,av:m}),d=0;d<b.length;d++)0!=b[d].N&&(b[d].av=b[d].Sum/b[d].N),o.push({category:"----------"+b[d].name,n:b[d].N,sum:b[d].Sum,av:b[d].av});return o},this.computeStartDateThisDay=function(c,d){var e,f,g,h,i,j;return d==a.adminRoleName?(e=b.getConstValueByName("startDayHH"),f=b.getConstValueByName("startDayMM"),g=0,i=c.getHours()<e?c-b.getOneDayInMSec():c):(h=b.getConstValueByName("usersSeeHistoryMin"),i=new Date(c-60*h*1e3),e=i.getHours(),f=i.getMinutes(),g=i.getSeconds()),j=new Date(i),j.setHours(e,f,g,0),j},this.computeStartDateThisMonth=function(a){var c,d,e=b.getConstValueByName("startDayHH"),f=b.getConstValueByName("startDayMM"),g=b.getConstValueByName("startDay");return c=a.getDate()<g||a.getDate()==g&&a.getHours()<e?a-10*b.getOneDayInMSec():a,d=new Date(c),d.setDate(g),d.setHours(e,f,0,0),d},this.computeDatesPastYear=function(a){var c,d,e={},f=b.getConstValueByName("pastYearBookingsPeriod"),g=b.getOneDayInMSec();return c=a-365*g,d=a-365*g+f*g,e.startDate=new Date(c),e.startDate.setHours(0,0,0,0),e.endDate=new Date(d),e.endDate.setHours(0,0,0,0),e},this.isSelectedPromoBirthday=function(a,b){for(var c,d,e=!1,f=!0,g=0;f;)a==b[g].id?(c=b[g].type,d=b[g].value,f=!1):(g++,g>=b.length&&(f=!1));return e="fixAmount"==c&&0==d?!0:!1},this.actualizateGuest=function(a,b){var c=a,d=this.isSelectedPromoBirthday(c.promotion,b);return c.isEmployee?c.isFree=!0:(c.isDirector=!1,c.isEmployeeAtWork=!1),c.isEmployee&&c.isDirector&&(c.isEmployeeAtWork=!1),!c.isFree&&"Нет"!=c.promotion||d||(c.promotion=null),c.isActive=!0,c.isChecked=!1,c},this.isSelectedEmplDir=function(a,b){for(var c=!1,d=!0,e=0;d;)a==b[e].id?(c=b[e].isDirector,d=!1):(e++,e>=b.length&&(d=!1));return c},this.changeEmplIsDir=function(a,b){var c=!1,d=this.isSelectedEmplDir(a,b);return c=d?!0:!1},this.changeEmplName=function(a,b){for(var c,d=!0,e=0;d;)a==b[e].id?(c=b[e].name,d=!1):(e++,e>=b.length&&(d=!1));return c}}]).factory("staffFactory",["$resource","baseURL",function(a,b){return a(b+"staffs/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).factory("roleFactory",["$resource","baseURL",function(a,b){return a(b+"roles/:id",{},{query:{method:"GET",isArray:!0},get:{method:"GET"}})}]).factory("roleMappingFactory",["$resource","baseURL",function(a,b){return a(b+"RoleMappings/:id",{},{query:{method:"GET",isArray:!0},create:{method:"POST"},get:{method:"GET"},remove:{method:"DELETE"},update:{method:"PUT"}})}]).service("roleDetails",[function(){this.getRoleDetailsByUserId=function(a,b,c){for(var d="",e="",f="",g={},h=!0,i=0;h;)a==b[i].principalId?(e=b[i].roleId,f=b[i].id,h=!1):(i++,i>=b.length&&(h=!1));for(h=!0,i=0;h;)e==c[i].id?(d=c[i].name,h=!1):(i++,i>=c.length&&(h=!1));return g.roleName=d,g.roleId=e,g.roleMappingId=f,g}}]).service("userDetails",[function(){this.getUserNameByUserId=function(a,b){for(var c="",d=!0,e=0;d;)a==b[e].id?(c=b[e].email,d=!1):(e++,e>=b.length&&(d=!1));return c}}]).service("promoDetails",[function(){this.getNameById=function(a,b){var c;if(void 0!=a)for(var d=!0,e=0;d;)a==b[e].id?(c=b[e].name,d=!1):(e++,e>=b.length&&(d=!1));else c=void 0;return c}}]).service("rowColorsGuests",[function(){this.setRowColor=function(a,b,c){var d="default";return d=c?"success":a?"danger":void 0!=b&&null!=b&&"Нет"!=b?"info":"active"},this.setRowColorEmpl=function(a){var b="default";return b=a?"success":"danger"}}]).service("rowColorsBookings",[function(){this.setRowColor=function(a,b){var c="active";return a==b[1]?c="success":a==b[2]?c="info":a==b[3]&&(c="danger"),c}}]).service("convertMMtoDDHHMM",[function(){this.convertMinutes=function(a){var b,c,d,e,f,g,h,i=1440;return 60>a?e=a.toString()+" м.":i>a?(c=Math.floor(a/60),g=c.toString(),d=a%60,h=d.toString(),e=g+" ч. "+h+" м."):a>=i&&(b=Math.floor(a/i),f=b.toString(),c=Math.floor((a-b*i)/60),g=c.toString(),d=(a-b*i)%60,h=d.toString(),e=f+" д. "+g+" ч. "+h+" м."),e}}]).service("checkoutService",[function(){var a,b=[];this.saveArr=function(c,d){b=c,a=d},this.fetchArr=function(){return b},this.fetchDateTime=function(){return a}}]).service("msgService",[function(){var a=[{name:"selectGuestToClose",text:"Нужно выбрать одного или нескольких гостей, которых вы хотите закрыть."},{name:"loadingInProgress",text:"Загрузка данных..."},{name:"cannotQueryData",text:"Не могу получить данные с сервера. "},{name:"doNotRemoveFrstRow",text:"Не нужно удалять первую строку. Просто нажмите Отменить, если не хотите добавлять группу."},{name:"needNamesForAllGuests",text:"Укажите имена для всех гостей."},{name:"selectJustOneRow",text:"Для изменения можно выбрать только одну запись."},{name:"selectTheRowToChange",text:"Выберите одну запись для изменения."},{name:"selectTheRowToDelete",text:"Выберите запись для удаления."},{name:"cannotUpdageRecord",text:"Не могу обновить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"cannotSaveRecord",text:"Не могу добавить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"cannotDeleteRecord",text:"Не могу удалить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"recordCreated",text:"Запись успешно создана"},{name:"needDateTimeBooking",text:"Укажите дату и время брони"},{name:"noBookingInPast",text:"Дата и время брони должны быть больше текущих"},{name:"bookingPhoneNotUnique",text:"Создание брони: клиент с таким номером уже есть в списке, не сохраняем"},{name:"bookingWrongStatus",text:"У брони нельзя или нет смысла менять статус: "},{name:"validateDatesBegEnd",text:"Дата окончания выборки должна быть больше даты начала"},{name:"adminRoleNeeded",text:"Данная операция доступна только для пользователей с расширенными правами. Если Вы уверены, что у вас есть такие права, попробуйте выйти и войти заново."},{name:"cannotChangeOldHisotory",text:"Изменить можно данные только по тем гостям, которые убыли в течение 24 часов; старые данные не подлежат изменению."},{name:"phoneNotUnique",text:"Номер телефона является уникальным, не должен повторяться. Клиент с таким номером телефона уже существует."},{name:"phoneWrongFormat",text:"Не могу добавить клиента. Некорректный формат телефона."},{name:"selectFile",text:"Сначала нужно выбрать файл"},{name:"clientsUploadCompleted",text:"Процедура загрузки клиентов из файла завершена. Были созданы все клиенты, кроме клиентов с повторящимимся и некорректными номерами."},{name:"passwordIsNotConfirmed",text:"Пароль и повторение пароля не совпадают."},{name:"cannotDeleteAdminUser",text:"Не могу удалить пользователя с расширенными правами"},{name:"cannotLogin",text:"Не могу войти. Проверьте логин и пароль."},{name:"cannotUpdateThisBooking",text:"Изменять можно только брони со статусом Новая"},{name:"confirmBackToMain",text:"Гость будет возвращён в Зал. Подтвердите."}];this.getMsg=function(b){for(var c="",d=!0,e=0;d;)a[e].name==b?(c=a[e].text,d=!1):(e++,e>=a.length&&(d=!1));return c}}]).service("guestFilterFactory",[function(){this.searchGuestNameAndCompany=function(a,b){var c,d=b.toUpperCase();if(""==d||null==d||void 0==d)c=!0;else{var e,f,g=a.name;if(""==g||null==g||void 0==g)e=!1;else{var h=g.toUpperCase();e=h.includes(d)}var i=a.companyN;if(""==i||null==i||void 0==i)f=!1;else{var j=i.toString(),k=j.toUpperCase();f=k==d?!0:!1}c=e||f}return c},this.computeSearchTotals=function(a,b){var c=[];c[0]=0,c[1]=0;for(var d=b.length,e=0;d>e;e++)this.searchGuestNameAndCompany(b[e],a)&&(c[0]++,c[1]=c[1]+b[e].amount);return c}}]).service("textConsts",[function(){const a=[{name:"hourStep",value:1},{name:"minuteStep",value:10},{name:"format",value:"dd.MM.yyyy"},{name:"showWeeks",value:!1},{name:"startingDay",value:1}],b="+7(999)999 99 99",c=["Новая","Пришли","Не пришли","Отмена"],d="user",e=[{type:"fixAmount",desc:"Фиксированная стоимость"},{type:"fixDiscount",desc:"Скидка"}],f="admin",g=864e5,h=[{name:"pricePerMinute",value:10,desc:"Цена за минуту, тг"},{name:"maxAmount",value:3e3,desc:"Максимальный чек, тг"},{name:"startDay",value:6,desc:"Первый день отчетного месяца"},{name:"startDayHH",value:10,desc:"Старт первого дня ЧАСЫ"},{name:"startDayMM",value:0,desc:"Старт первого дня МИНУТЫ"},{name:"usersSeeHistoryMin",value:30,desc:"Сколько минут истории видят пользователи"},{name:"adminWagePerHour",value:300,desc:"З/п админа за час, тг"},{name:"pastYearBookingsPeriod",value:7,desc:"За сколько дней показывать прошлогодние брони"},{name:"companiesMaxNum",value:50,desc:"Макс. кол-во компаний (зал, добавление гостя)"}];this.getCalendarSetting=function(b){for(var c,d=0;d<a.length;d++)a[d].name==b&&(c=a[d].value);return c},this.getPhoneMask=function(){return b},this.getBookingStatuses=function(){return c},this.getDefaultRoleForNewUsers=function(){return d},this.getPromotionTypes=function(){return e},this.getAdminRoleName=function(){return f},this.getOneDayInMSec=function(){return g},this.getConstArr=function(){return h},this.getConstValueByName=function(a){for(var b,c=!0,d=0;c;)a==h[d].name?(b=h[d].value,c=!1):(d++,d>=h.length&&(c=!1));return b}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="lbServices"),function(a,b,c){function d(a){var b=a.match(/^(?:https?:)?\/\/([^\/]+)/);return b?b[1]:null}var e="http://0.0.0.0:3000/api/",f="authorization",g=d(e)||location.host,h=b.module("lbServices",["ngResource"]);h.factory("User",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/Staffs/:id",{id:"@id"},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:e+"/Staffs/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:e+"/Staffs/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:e+"/Staffs/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:e+"/Staffs/:id/accessTokens/count",method:"GET"},create:{url:e+"/Staffs",method:"POST"},createMany:{isArray:!0,url:e+"/Staffs",method:"POST"},upsert:{url:e+"/Staffs",method:"PUT"},replaceOrCreate:{url:e+"/Staffs/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/Staffs/upsertWithWhere",method:"POST"},exists:{url:e+"/Staffs/:id/exists",method:"GET"},findById:{url:e+"/Staffs/:id",method:"GET"},replaceById:{url:e+"/Staffs/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/Staffs",method:"GET"},findOne:{url:e+"/Staffs/findOne",method:"GET"},updateAll:{url:e+"/Staffs/update",method:"POST"},deleteById:{url:e+"/Staffs/:id",method:"DELETE"},count:{url:e+"/Staffs/count",method:"GET"},prototype$updateAttributes:{url:e+"/Staffs/:id",method:"PUT"},createChangeStream:{url:e+"/Staffs/change-stream",method:"POST"},login:{params:{include:"user"},interceptor:{response:function(a){var c=a.data;return b.setUser(c.id,c.userId,c.user),b.rememberMe=a.config.params.rememberMe!==!1,b.save(),a.resource}},url:e+"/Staffs/login",method:"POST"},logout:{interceptor:{response:function(a){return b.clearUser(),b.clearStorage(),a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),a.resource}},url:e+"/Staffs/logout",method:"POST"},confirm:{url:e+"/Staffs/confirm",method:"GET"},resetPassword:{url:e+"/Staffs/reset",method:"POST"},"::get::AccessToken::user":{url:e+"/AccessTokens/:id/user",method:"GET"},getCurrent:{url:e+"/Staffs/:id",method:"GET",params:{id:function(){var a=b.currentUserId;return null==a&&(a="__anonymous__"),a}},interceptor:{response:function(a){return b.currentUserData=a.data,a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),d.reject(a)}},__isGetCurrentUser__:!0}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.getCachedCurrent=function(){var a=b.currentUserData;return a?new f(a):null},f.isAuthenticated=function(){return null!=this.getCurrentId()},f.getCurrentId=function(){return b.currentUserId},f.modelName="User",f.accessTokens=function(){var a=c.get("AccessToken"),b=a["::get::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.count=function(){var a=c.get("AccessToken"),b=a["::count::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.create=function(){var a=c.get("AccessToken"),b=a["::create::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.createMany=function(){var a=c.get("AccessToken"),b=a["::createMany::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.destroyAll=function(){var a=c.get("AccessToken"),b=a["::delete::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.destroyById=function(){var a=c.get("AccessToken"),b=a["::destroyById::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.findById=function(){var a=c.get("AccessToken"),b=a["::findById::User::accessTokens"];return b.apply(f,arguments)},f.accessTokens.updateById=function(){var a=c.get("AccessToken"),b=a["::updateById::User::accessTokens"];return b.apply(f,arguments)},f}]),h.factory("AccessToken",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/AccessTokens/:id",{id:"@id"},{prototype$__get__user:{url:e+"/AccessTokens/:id/user",method:"GET"},create:{url:e+"/AccessTokens",method:"POST"},createMany:{isArray:!0,url:e+"/AccessTokens",method:"POST"},upsert:{url:e+"/AccessTokens",method:"PUT"},replaceOrCreate:{url:e+"/AccessTokens/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/AccessTokens/upsertWithWhere",method:"POST"},exists:{url:e+"/AccessTokens/:id/exists",method:"GET"},findById:{url:e+"/AccessTokens/:id",method:"GET"},replaceById:{url:e+"/AccessTokens/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/AccessTokens",method:"GET"},findOne:{url:e+"/AccessTokens/findOne",method:"GET"},updateAll:{url:e+"/AccessTokens/update",method:"POST"},deleteById:{url:e+"/AccessTokens/:id",method:"DELETE"},count:{url:e+"/AccessTokens/count",method:"GET"},prototype$updateAttributes:{url:e+"/AccessTokens/:id",method:"PUT"},createChangeStream:{url:e+"/AccessTokens/change-stream",method:"POST"},"::findById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"GET"},"::destroyById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"DELETE"},"::updateById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Staffs/:id/accessTokens/:fk",method:"PUT"},"::get::User::accessTokens":{isArray:!0,url:e+"/Staffs/:id/accessTokens",method:"GET"},"::create::User::accessTokens":{url:e+"/Staffs/:id/accessTokens",method:"POST"},"::createMany::User::accessTokens":{isArray:!0,url:e+"/Staffs/:id/accessTokens",method:"POST"},"::delete::User::accessTokens":{url:e+"/Staffs/:id/accessTokens",method:"DELETE"},"::count::User::accessTokens":{url:e+"/Staffs/:id/accessTokens/count",method:"GET"},"::findById::Staff::accessTokens":{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"GET"},"::destroyById::Staff::accessTokens":{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"DELETE"},"::updateById::Staff::accessTokens":{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"PUT"},"::get::Staff::accessTokens":{isArray:!0,url:e+"/staffs/:id/accessTokens",method:"GET"},"::create::Staff::accessTokens":{url:e+"/staffs/:id/accessTokens",method:"POST"},"::createMany::Staff::accessTokens":{isArray:!0,url:e+"/staffs/:id/accessTokens",method:"POST"},"::delete::Staff::accessTokens":{url:e+"/staffs/:id/accessTokens",method:"DELETE"},"::count::Staff::accessTokens":{url:e+"/staffs/:id/accessTokens/count",method:"GET"}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.modelName="AccessToken",f.user=function(){var a=c.get("User"),b=a["::get::AccessToken::user"];return b.apply(f,arguments)},f}]),h.factory("Clients",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/clients/:id",{id:"@id"},{create:{url:e+"/clients",method:"POST"},createMany:{isArray:!0,url:e+"/clients",method:"POST"},upsert:{url:e+"/clients",method:"PUT"},replaceOrCreate:{url:e+"/clients/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/clients/upsertWithWhere",method:"POST"},exists:{url:e+"/clients/:id/exists",method:"GET"},findById:{url:e+"/clients/:id",method:"GET"},replaceById:{url:e+"/clients/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/clients",method:"GET"},findOne:{url:e+"/clients/findOne",method:"GET"},updateAll:{url:e+"/clients/update",method:"POST"},deleteById:{url:e+"/clients/:id",method:"DELETE"},count:{url:e+"/clients/count",method:"GET"},prototype$updateAttributes:{url:e+"/clients/:id",method:"PUT"},createChangeStream:{url:e+"/clients/change-stream",method:"POST"}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.modelName="Clients",f}]),h.factory("Guests",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/guests/:id",{id:"@id"},{prototype$__get__promotionID:{url:e+"/guests/:id/promotionID",method:"GET"},create:{url:e+"/guests",method:"POST"},createMany:{isArray:!0,url:e+"/guests",method:"POST"},upsert:{url:e+"/guests",method:"PUT"},replaceOrCreate:{url:e+"/guests/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/guests/upsertWithWhere",method:"POST"},exists:{url:e+"/guests/:id/exists",method:"GET"},findById:{url:e+"/guests/:id",method:"GET"},replaceById:{url:e+"/guests/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/guests",method:"GET"},findOne:{url:e+"/guests/findOne",method:"GET"},updateAll:{url:e+"/guests/update",method:"POST"},deleteById:{url:e+"/guests/:id",method:"DELETE"},count:{url:e+"/guests/count",method:"GET"},prototype$updateAttributes:{url:e+"/guests/:id",method:"PUT"},createChangeStream:{url:e+"/guests/change-stream",method:"POST"}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.modelName="Guests",f.promotionID=function(){var a=c.get("Promotion"),b=a["::get::Guests::promotionID"];return b.apply(f,arguments)},f}]),h.factory("Const",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/consts/:id",{id:"@id"},{create:{url:e+"/consts",method:"POST"},createMany:{isArray:!0,url:e+"/consts",method:"POST"},upsert:{url:e+"/consts",method:"PUT"},replaceOrCreate:{url:e+"/consts/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/consts/upsertWithWhere",method:"POST"},exists:{url:e+"/consts/:id/exists",method:"GET"},findById:{url:e+"/consts/:id",method:"GET"},replaceById:{url:e+"/consts/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/consts",method:"GET"},findOne:{url:e+"/consts/findOne",method:"GET"},updateAll:{url:e+"/consts/update",method:"POST"},deleteById:{url:e+"/consts/:id",method:"DELETE"},count:{url:e+"/consts/count",method:"GET"},prototype$updateAttributes:{url:e+"/consts/:id",method:"PUT"},createChangeStream:{url:e+"/consts/change-stream",method:"POST"}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.modelName="Const",f}]),h.factory("Promotion",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/promotions/:id",{id:"@id"},{create:{url:e+"/promotions",method:"POST"},createMany:{isArray:!0,url:e+"/promotions",method:"POST"},upsert:{url:e+"/promotions",method:"PUT"},replaceOrCreate:{url:e+"/promotions/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/promotions/upsertWithWhere",method:"POST"},exists:{url:e+"/promotions/:id/exists",method:"GET"},findById:{url:e+"/promotions/:id",method:"GET"},replaceById:{url:e+"/promotions/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/promotions",
method:"GET"},findOne:{url:e+"/promotions/findOne",method:"GET"},updateAll:{url:e+"/promotions/update",method:"POST"},deleteById:{url:e+"/promotions/:id",method:"DELETE"},count:{url:e+"/promotions/count",method:"GET"},prototype$updateAttributes:{url:e+"/promotions/:id",method:"PUT"},createChangeStream:{url:e+"/promotions/change-stream",method:"POST"},"::get::Guests::promotionID":{url:e+"/guests/:id/promotionID",method:"GET"}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.modelName="Promotion",f}]),h.factory("Staff",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/staffs/:id",{id:"@id"},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:e+"/staffs/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:e+"/staffs/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:e+"/staffs/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:e+"/staffs/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:e+"/staffs/:id/accessTokens/count",method:"GET"},create:{url:e+"/staffs",method:"POST"},createMany:{isArray:!0,url:e+"/staffs",method:"POST"},upsert:{url:e+"/staffs",method:"PUT"},replaceOrCreate:{url:e+"/staffs/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/staffs/upsertWithWhere",method:"POST"},exists:{url:e+"/staffs/:id/exists",method:"GET"},findById:{url:e+"/staffs/:id",method:"GET"},replaceById:{url:e+"/staffs/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/staffs",method:"GET"},findOne:{url:e+"/staffs/findOne",method:"GET"},updateAll:{url:e+"/staffs/update",method:"POST"},deleteById:{url:e+"/staffs/:id",method:"DELETE"},count:{url:e+"/staffs/count",method:"GET"},prototype$updateAttributes:{url:e+"/staffs/:id",method:"PUT"},createChangeStream:{url:e+"/staffs/change-stream",method:"POST"},login:{params:{include:"user"},interceptor:{response:function(a){var c=a.data;return b.setUser(c.id,c.userId,c.user),b.rememberMe=a.config.params.rememberMe!==!1,b.save(),a.resource}},url:e+"/staffs/login",method:"POST"},logout:{interceptor:{response:function(a){return b.clearUser(),b.clearStorage(),a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),a.resource}},url:e+"/staffs/logout",method:"POST"},confirm:{url:e+"/staffs/confirm",method:"GET"},resetPassword:{url:e+"/staffs/reset",method:"POST"},getCurrent:{url:e+"/staffs/:id",method:"GET",params:{id:function(){var a=b.currentUserId;return null==a&&(a="__anonymous__"),a}},interceptor:{response:function(a){return b.currentUserData=a.data,a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),d.reject(a)}},__isGetCurrentUser__:!0}});return f.patchOrCreate=f.upsert,f.updateOrCreate=f.upsert,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.patchAttributes=f.prototype$updateAttributes,f.getCachedCurrent=function(){var a=b.currentUserData;return a?new f(a):null},f.isAuthenticated=function(){return null!=this.getCurrentId()},f.getCurrentId=function(){return b.currentUserId},f.modelName="Staff",f.accessTokens=function(){var a=c.get("AccessToken"),b=a["::get::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.count=function(){var a=c.get("AccessToken"),b=a["::count::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.create=function(){var a=c.get("AccessToken"),b=a["::create::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.createMany=function(){var a=c.get("AccessToken"),b=a["::createMany::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.destroyAll=function(){var a=c.get("AccessToken"),b=a["::delete::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.destroyById=function(){var a=c.get("AccessToken"),b=a["::destroyById::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.findById=function(){var a=c.get("AccessToken"),b=a["::findById::Staff::accessTokens"];return b.apply(f,arguments)},f.accessTokens.updateById=function(){var a=c.get("AccessToken"),b=a["::updateById::Staff::accessTokens"];return b.apply(f,arguments)},f}]),h.factory("LoopBackAuth",function(){function a(){var a=this;d.forEach(function(b){a[b]=c(b)}),this.currentUserData=null}function b(a,b,c){try{var d=e+b;null==c&&(c=""),a[d]=c}catch(f){console.log("Cannot access local/session storage:",f)}}function c(a){var b=e+a;return localStorage[b]||sessionStorage[b]||null}var d=["accessTokenId","currentUserId","rememberMe"],e="$LoopBack$";return a.prototype.save=function(){var a=this,c=this.rememberMe?localStorage:sessionStorage;d.forEach(function(d){b(c,d,a[d])})},a.prototype.setUser=function(a,b,c){this.accessTokenId=a,this.currentUserId=b,this.currentUserData=c},a.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},a.prototype.clearStorage=function(){d.forEach(function(a){b(sessionStorage,a,null),b(localStorage,a,null)})},new a}).config(["$httpProvider",function(a){a.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(a,b){return{request:function(e){var h=d(e.url);if(h&&h!==g)return e;if(b.accessTokenId)e.headers[f]=b.accessTokenId;else if(e.__isGetCurrentUser__){var i={body:{error:{status:401}},status:401,config:e,headers:function(){return c}};return a.reject(i)}return e||a.when(e)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(a){f=a},this.getAuthHeader=function(){return f},this.setUrlBase=function(a){e=a,g=d(e)||location.host},this.getUrlBase=function(){return e},this.$get=["$resource",function(a){var b=function(b,c,d){var e=a(b,c,d);return e.prototype.$save=function(a,b){var c=e.upsert.call(this,{},this,a,b);return c.$promise||c},e};return b.getUrlBase=function(){return e},b.getAuthHeader=function(){return f},b}]})}(window,window.angular),function(){function a(a,b){function c(b,c){return a.login({email:b,password:c}).$promise}function d(){return a.logout().$promise}function e(b,c,d){return a.create({email:b,password:c,created:d}).$promise}function f(){return a.isAuthenticated()}function g(){return a.getCurrent()}var h={login:c,logout:d,register:e,isAuthenticated:f,getCurrentUser:g};return h}angular.module("timeclubAngularApp").factory("authService",a),a.$inject=["User","$rootScope"]}(),function(a){if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL={}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=this.data.length=0},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f=!a.externalHost&&"download"in e,g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?d.revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(d,i){var m,o,p,q=this,r=d.type,s=!1,t=function(){var a=c().createObjectURL(d);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){if((s||!m)&&(m=t(d)),!o){if(navigator.userAgent.match(/7\.[\d\s\.]+Safari/)&&"undefined"!=typeof window.FileReader&&d.size<=157286400){var a=new window.FileReader;return a.readAsDataURL(d),a.onloadend=function(){var c=b.createElement("iframe");c.src=a.result,c.style.display="none",b.body.appendChild(c),u()},q.readyState=q.DONE,void(q.savedAs=q.SAVEDASUNKNOWN)}return window.open(m,"_blank"),q.readyState=q.DONE,q.savedAs=q.SAVEDASBLOB,void u()}o.location.href=m},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};if(q.readyState=q.INIT,i||(i="download"),f){m=t(d),b=a.document,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e.href=m,e.download=i;var y=b.createEvent("MouseEvents");return y.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(y),q.readyState=q.DONE,q.savedAs=q.SAVEDASBLOB,void u()}return a.chrome&&r&&r!==j&&(p=d.slice||d.webkitSlice,d=p.call(d,0,d.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=d.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var b=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(b){b.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,q.savedAs=q.SAVEDASBLOB,n(q,"writeend",b)},b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){b["on"+a]=q["on"+a]}),b.write(d),q.abort=function(){b.abort(),q.readyState=q.DONE,q.savedAs=q.FAILED},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),b()}),w(function(a){a.code===a.NOT_FOUND_ERR?b():v()}))}),v)}),v)):void v()},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,a.savedAs=a.FAILED,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.FAILED=-1,p.SAVEDASBLOB=1,p.SAVEDASURI=2,p.SAVEDASUNKNOWN=3,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q.unload=function(){m(),a.removeEventListener("unload",m,!1)},q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return saveAs}):"undefined"!=typeof Meteor&&(Meteor.saveAs=saveAs),angular.module("timeclubAngularApp").controller("EmplWagesCtrl",["$scope","guestCompute","$state","msgService","textConsts","convertMMtoDDHHMM","employeeWagesFactory","rowColorsGuests","guestFilterFactory","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j){a.showClients=!1,a.message=d.getMsg("loadingInProgress");var k;const l=e.getConstValueByName("adminWagePerHour");var m;j.get(function(c){m=c,a.startDateToday=new Date(m.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(c){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+d.getMsg("cannotQueryData"))}),a.getDatesAndFetchClients=function(b,c){b>c?window.alert(d.getMsg("validateDatesBegEnd")):g.query({start:b,end:c,emplFlag:!0,dirFlag:!1},function(b){a.clients=b,k=a.clients.length,a.showClients=!0,a.search=""},function(b){a.message=d.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.setRowBackgroud=function(a){var b;return b=h.setRowColorEmpl(a)},a.convertMinutes=function(a){var b=f.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=i.searchGuestNameAndCompany(b,a.search)},a.computeWage=function(a,b){var c;return c=b?Math.floor(a*l/60):0},a.hourStep=e.getCalendarSetting("hourStep"),a.minuteStep=e.getCalendarSetting("minuteStep"),a.format=e.getCalendarSetting("format"),a.dateOptions={showWeeks:e.getCalendarSetting("showWeeks"),startingDay:e.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").run(["$templateCache",function(a){a.put("views/checkoutdetails.html",'<div class="container"> <div class="Modal-box"> <div class="row" ng-show="!showInfo"> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <img src="images/logo.14f67a6e.png" align="left"> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <h1 align="left">Добро пожаловать  в <strong>Некафе на Джандосова!</strong></h1> </div> <div class="row"> <h2 align="center">ул. Джандосова, 82</h2> <h2 align="center">+7 747 666 99 56</h2> <h2 align="center">nekafe.kz</h2> </div> </div> <div ng-show="showInfo"> <h4><strong>Спасибо за то, что были у нас в гостях!</strong></h4> <div class="table-wrapper"> <table class="table table-condensed"> <tr> <td><strong>Всего гостей:</strong></td> <td><strong>{{totalN}}</strong></td> <td><strong>Всего сумма:</strong></td> <td><strong>{{amountCheckout | number:0}}</strong></td> </tr> </table> </div> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th>Имя</th> <th>Время</th> <th align="center">Сумма</th> <th>Акция</th> <th>Время прихода</th> <th>Время ухода</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guestToCheckout.isFree,guestToCheckout.promotion,guestToCheckout.isEmployee)" ng-repeat="guestToCheckout in guestsToCheckout | orderBy:\'arrivalTime\':true track by guestToCheckout.id"> <td><strong>{{guestToCheckout.name}}</strong></td> <td>{{convertMinutes(guestToCheckout.timeInClub)}}</td> <td align="center"><strong>{{guestToCheckout.amount | number:0}}</strong></td> <td>{{getPromoNameById(guestToCheckout.promotion)}}</td> <td>{{guestToCheckout.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guestToCheckout.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> </tr> </tbody> </table> </div> </div> </div> </div>'),a.put("views/clients.html",'<div class="container-fluid"> <h4><strong>Добавить клиента</strong></h4> <!-- add client form BEGIN --> <form class="form-inline" role="form" id="AddClientForm" ng-submit="addClient(newClient,true)"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="newClient.phone" required> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="newClient.name"> <label for="birthday" class="control-label">День рождения</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="newClient.birthdate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="true" hidden-date="false" name="birthday" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newClient.comment"> <button type="submit" class="btn btn-success" id="confirmAddClientButton" ng-disabled="AddClientForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddClientButton" ng-click="cancelAddingClient()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> <!-- add client form END --> <h4><strong>Загрузить клиентов из Excel файла</strong></h4> <!-- create clients from Excel file BEGIN --> <form class="form-inline"> <button class="btn btn-info" id="templateXLS" ng-click="downloadExampleXLS()"> <span class="glyphicon glyphicon-download" aria-hidden="true"></span> Скачать файл-образец</button> <label class="btn btn-primary btn-file"> Выбрать файл... <input type="file" name="xlfile" id="xlf" style="display: none"> </label> <button class="btn btn-primary" id="upoadList" ng-click="uploadFromXLS()"> <span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Загрузить список из файла</button> </form> <!-- create clients from Excel file END --> <br><br> <pre id="out"></pre> <h4><strong>Общий список клиентов</strong></h4> <!-- search client form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> <span>&nbsp;&nbsp;&nbsp;</span> <button class="btn btn-danger" id="deleteClient" ng-click="DeleteClient()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить</button> </form> <!-- search client form END --> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="table-wrapper"> <!-- list of clients BEGIN --> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Мобильный телефон</th> <th>Имя</th> <th>День рождения</th> <th>Комментарий</th> <th>Системный комментарий</th> </tr> </thead> <tbody> <!--<tr ng-repeat="client in clientlist | filter:search track by client.id" ng-show="showInfo">--> <tr dir-paginate="client in clientlist | filter:search |itemsPerPage:10 track by client.id" ng-show="showInfo"> <td><input type="checkbox" ng-model="client.isSelected"></td> <td>{{client.phone | phoneFilter}}</td> <td>{{client.name}}</td> <td>{{client.birthdate | date: \'dd.MM.y\' : \'+0600\'}}</td> <td>{{client.comment}}</td> <td>{{client.sysComment}}</td> </tr> </tbody> </table> <!-- pagination controls --> <dir-pagination-controls max-size="5" direction-links="true" boundary-links="true"> </dir-pagination-controls> <!-- list of clients END --> </div> </div>'),a.put("views/confirm.html",'<div class="container"> <div class="Modal-box"> <h3>Закрыть выбранных гостей?</h3> <div class="table-wrapper"> <table class="table table-condensed"> <tr> <td><h3>Всего гостей:</h3></td> <td><h3><strong>{{totalN}}</strong></h3></td> <td><h3>Всего сумма:</h3></td> <td><h3><strong>{{amountCheckout | number:0}}</strong></h3></td> </tr> </table> </div> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guestToCheckout.isFree,guestToCheckout.promotion,guestToCheckout.isEmployee)" ng-repeat="guestToCheckout in guestsToCheckout | orderBy:\'arrivalTime\':true track by guestToCheckout.id"> <td><strong>{{guestToCheckout.name}}</strong></td> <td>{{guestToCheckout.companyN}}</td> <td align="center"><strong>{{guestToCheckout.amount | number:0}}</strong></td> <td>{{convertMinutes(guestToCheckout.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!guestToCheckout.isEmployee">Клиент</p><p ng-if="guestToCheckout.isEmployee && guestToCheckout.isEmployeeAtWork">Сотрудник Смена</p><p ng-if="guestToCheckout.isEmployee && !guestToCheckout.isEmployeeAtWork">Сотрудник Просто</p></td> <td><p ng-if="guestToCheckout.isFree">Бесплатно</p><p ng-if="!guestToCheckout.isFree">Платно</p></td> <td>{{getPromoNameById(guestToCheckout.promotion)}}</td> <td class="narrowColumn">{{guestToCheckout.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guestToCheckout.comment}}</td> </tr> </tbody> </table> </div> <button class="btn btn-success" ng-click="checkoutGuests()" ng-disabled="isPaidButtonActive">Да</button> <button class="btn btn-danger" ng-click="cancleCheckoutGuests()" ng-disabled="isPaidButtonActive">Отмена</button> <button class="btn btn-info" ng-click="closeCheckoutWindow()" ng-disabled="!isPaidButtonActive">Оплачено</button> </div> </div>'),a.put("views/dashboard.html",'<div class="container"> <div class="row row-content"> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive" ng-if="showInfo"> <thead> <tr> <th>Категория</th> <th align="right"><strong>Сумма</strong></th> <th>Всего людей</th> <th>Сотрудников</th> <th>Гостей</th> <th>Платных гостей</th> <th>Бесплатных гостей</th> </tr> </thead> <tbody> <tr> <td><strong>Сейчас в Некафе</strong> (в зале):</td> <td align="right"><strong>{{outStatNow[5] | number:0 }}</strong></td> <td>{{outStatNow[0]}}</td> <td>{{outStatNow[1]}}</td> <td>{{outStatNow[2]}}</td> <td>{{outStatNow[3]}}</td> <td>{{outStatNow[4]}}</td> </tr> <tr> <td><strong>Некафе за сегодня:</strong> начиная с <strong>{{startDate | date: \'dd.MM.y H:mm:ss\'}}</strong></td> <td align="right"><strong>{{outStatToday[5] | number:0 }}</strong></td> <td>{{outStatToday[0]}}</td> <td>{{outStatToday[1]}}</td> <td>{{outStatToday[2]}}</td> <td>{{outStatToday[3]}}</td> <td>{{outStatToday[4]}}</td> </tr> <tr> <td><strong>Некафе за этот месяц:</strong> начиная с <strong>{{startDate2 | date: \'dd.MM.y H:mm:ss\'}}</strong></td> <td align="right"><strong>{{outStatMonth[5] | number:0 }}</strong></td> <td>{{outStatMonth[0]}}</td> <td>{{outStatMonth[1]}}</td> <td>{{outStatMonth[2]}}</td> <td>{{outStatMonth[3]}}</td> <td>{{outStatMonth[4]}}</td> </tr> </tbody> </table> </div> </div> </div>'),a.put("views/emplwages.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <!-- set period form BEGIN--> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showClientsData" ng-click="getDatesAndFetchClients(startDate,endDate)">Показать</button> </div> </form> <!-- set period form END--> </div> <hr> <div class="row"> <div class="col-xs-12" ng-if="!showClients"><!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <h4><strong>Список сотрудников</strong></h4> <div class="row row-content"> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> <!-- search guest form END --> <br> <!-- list of guests BEGIN --> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th></th> <th>Имя</th> <th class="narrowColumn">Тип</th> <th class="narrowColumn">Время прихода</th> <th class="narrowColumn">Время ухода</th> <th align="center">Итого минут</th> <th align="center">Итого сумма, тг</th> <th>Время</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(client.isEmployeeAtWork)" ng-repeat="client in clients | filter:searchNameAndCompany | orderBy:\'checkoutTime\' track by client.id" ng-show="showClients"> <td><input type="checkbox" ng-model="client.isChecked"></td> <td><strong>{{client.name}}</strong></td> <td class="narrowColumn"><p ng-if="!client.isEmployee">Клиент</p><p ng-if="client.isEmployee && client.isEmployeeAtWork && !client.isDirector">Сотрудник Смена</p><p ng-if="client.isEmployee && !client.isEmployeeAtWork && !client.isDirector">Сотрудник Просто</p><p ng-if="client.isEmployee && client.isDirector">Директор</p></td> <td class="narrowColumn">{{client.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td class="narrowColumn">{{client.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td align="center">{{client.timeInClub}}</td> <td align="center">{{computeWage(client.timeInClub,client.isEmployeeAtWork) | number:0}}</td> <td>{{convertMinutes(client.timeInClub)}}</td> <td>{{client.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div>'),a.put("views/footer.html",'<div class="footer"> <div class="container-fluid"> <div class="span4 offset4 text-center"> <p>Некафе на Джандосова - учет гостей</p> </div> </div> </div>'),a.put("views/header-login.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <p></p> </div> </div> </div>'),a.put("views/header.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container-fluid"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse" ng-click="collapse()"> <span class="sr-only">Навигация</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <!-- modify guest form END --> <a class="navbar-brand" ui-sref="app"><img src="images/logo.14f67a6e.png" height="30" width="30"></a> <button type="button" class="btn btn-info navbar-brand" id="ReloadButton" ng-click="stateReload()"> <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse" uib-collapse="isCollapsed"> <ul class="nav navbar-nav" ng-click="collapse()"> <li ui-sref-active-eq="active"><a ui-sref="app"><span class="glyphicon glyphicon-home" aria-hidden="true"></span> Зал</a></li> <li ui-sref-active-eq="active"><a ui-sref="app.reservations"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span> Брони</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.dashboard"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> Дашборд</a></li> <li ui-sref-active-eq="active"><a ui-sref="app.history"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> История</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.stat"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span> Статистика</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.emplwages"><span class="glyphicon glyphicon-usd" aria-hidden="true"></span> З/п админов</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.clients"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Клиенты</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.preferences"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Настройки</a></li> <li ui-sref-active-eq="active"><a ui-sref="Modal.checkoutDetails"><span class="glyphicon glyphicon-film" aria-hidden="true"></span> Закрытие</a></li> </ul> <ul class="nav navbar-nav navbar-right"> <li><a id="LogoutButton" role="button" ng-click="logout()"> <span class="glyphicon glyphicon-log-out"></span> Выход</a> </li> </ul> </div> </div> </div> </div>'),a.put("views/history.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <!-- set period form BEGIN--> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showClientsData" ng-click="getDatesAndFetchClients(startDate,endDate)" ng-disabled="!isCurrentUserAnAdminUser">Показать</button> </div> </form> <!-- set period form END--> </div> <hr> <div class="row"> <div class="col-xs-12" ng-if="!showClients"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <!-- total BEGIN--> <h4><strong>Итого за период с {{startDate | date: \'dd.MM.y H:mm:ss\'}} по {{endDate | date: \'dd.MM.y H:mm:ss\'}}</strong></h4> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive" ng-if="showClients"> <tbody ng-if="showClients"> <tr> <td><strong>Сумма</strong></td> <td><strong>{{outStat[5] | number:0 }}</strong></td> <td>Всего людей</td> <td>{{outStat[0]}}</td> <td>Сотрудников</td> <td>{{outStat[1]}}</td> <td><strong>Гостей</strong></td> <td><strong>{{outStat[2]}}</strong></td> <td>Платных гостей</td> <td>{{outStat[3]}}</td> <td>Бесплатных гостей</td> <td>{{outStat[4]}}</td> </tr> </tbody> </table> </div> <!-- total END--> <hr> <h4><strong>Список гостей</strong></h4> <div class="row row-content"> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <button class="btn btn-info" id="editGuestButton" ng-show="showChangeButton" ng-disabled="!isCurrentUserAnAdminUser" ng-click="editGuests()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Изменить</button> <button class="btn btn-success" id="backToMainButton" ng-show="showChangeButton" ng-disabled="!isCurrentUserAnAdminUser" ng-click="backToMain()"> <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Вернуть в зал</button> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" align="right"> <!-- totals for searched items BEGIN--> <table> <tr> <td><strong>Гости:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[0]}}</strong></td> <td>&nbsp;&nbsp;&nbsp;</td> <td><strong>Сумма:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[1] | number:0}}</strong></td> </tr> </table> <!-- totals for searched items END--> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> </div> <!-- search guest form END --> <br> <div class="table-wrapper"> <!-- modify form BEGIN--> <table class="table table-condensed table-responsive" ng-show="showEditGuestModal"> <tr ng-class="setRowBackgroud(guestToEdit.isFree,guestToEdit.promotion,guestToEdit.isEmployee)"> <td> <form class="form-inline" role="form" id="EditGuestForm" ng-submit="postChangesToGuest()"> <label for="guestNameEdit" class="control-label" ng-show="!guestToEdit.isEmployee">Имя</label> <input type="text" id="guestNameEdit" class="form-control" placeholder="Имя гостя" ng-model="guestToEdit.name" ng-show="!guestToEdit.isEmployee" required> <label for="emplName" class="control-label" ng-show="guestToEdit.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="guestToEdit.isEmployee" ng-model="guestToEdit.emplID" ng-change="guestToEdit.isDirector=changeEmplIsDir(guestToEdit.emplID);guestToEdit.name=changeEmplName(guestToEdit.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isEmployee" ng-change="guestToEdit.isFree=guestToEdit.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isDirector" ng-show="guestToEdit.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="guestToEdit.isEmployeeAtWork" ng-show="guestToEdit.isEmployee" ng-disabled="guestToEdit.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!guestToEdit.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.companyN"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!guestToEdit.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.promotion" ng-disabled="guestToEdit.isFree && disablePromoSelectED" ng-change="guestToEdit.isFree=changeIsFreeFlagByPromo(guestToEdit.promotion,\'ED\',guestToEdit.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="guestToEdit.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="guestToEdit.isFree" ng-disabled="guestToEdit.isEmployee || disableIsFreeED" ng-change="guestToEdit.promotion=removePromoIfFree(guestToEdit.isFree,guestToEdit.promotion)"> Бесплатный</label> </div> <button type="submit" class="btn btn-success" id="confirmAddGuestButton" ng-disabled="EditGuestForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddGuestButton" ng-click="cancelEditingGuest()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> </td> </tr> </table> <!-- modify form END--> </div> <!-- list of guests BEGIN --> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th></th> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th class="narrowColumn">Время ухода</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(client.isFree,client.promotion,client.isEmployee)" ng-repeat="client in clients | filter: searchNameAndCompany | orderBy:\'checkoutTime\':true track by client.id" ng-show="showClients"> <td><input type="checkbox" ng-model="client.isChecked"></td> <td><strong>{{client.name}}</strong></td> <td>{{client.companyN}}</td> <td align="center"><strong>{{client.amount | number:0 }}</strong></td> <td>{{convertMinutes(client.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!client.isEmployee">Клиент</p><p ng-if="client.isEmployee && client.isEmployeeAtWork && !client.isDirector">Сотрудник Смена</p><p ng-if="client.isEmployee && !client.isEmployeeAtWork && !client.isDirector">Сотрудник Просто</p><p ng-if="client.isEmployee && client.isDirector">Директор</p></td> <td><p ng-if="client.isFree">Бесплатно</p><p ng-if="!client.isFree">Платно</p></td> <td>{{getPromoNameById(client.promotion)}}</td> <td class="narrowColumn">{{client.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td class="narrowColumn">{{client.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{client.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div>'),
a.put("views/login.html",'<div class="container-fluid"> <div class="row"> <div class="col-lg-5 col-md-4 col-sm-4 col-xs-12"></div> <div class="col-lg-2 col-md-4 col-sm-4 col-xs-12"> <h3>Некафе на Джандосова </h3> <form ng-submit="login()"> <div class="form-group"> <label class="sr-only" for="username">E-mail</label> <input type="text" class="form-control input-sm" id="username" placeholder="e-mail" ng-model="username"> </div> <div class="form-group"> <label class="sr-only" for="password">Пароль</label> <input type="password" class="form-control input-sm" id="password" placeholder="пароль" ng-model="password"> </div> <button type="submit" class="btn btn-info btn-sm">Вход</button> <button type="button" class="btn btn-default btn-sm" ng-click="cancelLogin()">Отмена</button> <br> <br> </form> </div> <div class="col-lg-5 col-md-4 col-sm-4 col-xs-12"></div> </div> </div>'),a.put("views/main.html",'<div class="row"> <div class="col-xs-12" ng-if="!showGuests"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <!-- total table BEGIN --> <div class="row"> <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12"><!-- fix at the top --> <!--<div class="container-fluid fixedTopPosition">--> <div class="container-fluid"> <div class="row"> <h4><strong>Сейчас в зале</strong></h4> <table class="table table-striped table-condensed table-responsive"> <tr> <td class="narrowColumn"><strong>Время</strong></td> <td class="narrowColumn"><strong>{{currentTimeToShow | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Сумма</strong></td> <td class="narrowColumn"><strong>{{outStatNow[5] | number:0}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Всего людей</strong></td> <td class="narrowColumn"><strong>{{outStatNow[0]}}</strong></td> </tr> <tr class="success"> <td class="narrowColumn"><strong>Сотрудников</strong></td> <td class="narrowColumn"><strong>{{outStatNow[1]}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Всего гостей</strong></td> <td class="narrowColumn"><strong>{{outStatNow[2]}}</strong></td> </tr> <tr class="default"> <td class="narrowColumn">Платно</td> <td class="narrowColumn">{{outStatNow[3]}}</td> </tr> <tr class="danger"> <td class="narrowColumn">Бесплатно</td> <td class="narrowColumn">{{outStatNow[4]}}</td> </tr> <!--<option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}--> </table> </div> </div> </div> <!-- total table END --> <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12"> <div class="container-fluid"> <div class="row" ng-show="showAddGroupModule"> <!-- add guest / company BEGIN --> <h4><strong>Добавить гостя или компанию</strong></h4> <button type="button" class="btn btn-info" id="addGroupButton" ng-click="fillGroupInfo()" ng-disabled="showAddGroupTable"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-success" id="setGroup" ng-show="showAddGroupTable" ng-click="putGroupIntoDB()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Готово</button> <button type="button" class="btn btn-danger" id="cancelSetGroup" ng-click="cancelFillGroupInfo()" ng-show="showAddGroupTable"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <br><br> <table class="table table-condensed table-responsive" id="addGroupTable" ng-show="showAddGroupTable"> <tr ng-repeat="newGuest in newGuests" ng-class="setRowBackgroud(newGuest.isFree,newGuest.promotion,newGuest.isEmployee)"> <td> <form class="form-inline" role="form"> <span>&nbsp;{{newGuest.guestIndex+1}}&nbsp;</span> <button type="button" class="btn btn-success" ng-click="addOneGuestToGroup()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" ng-click="removeOneGuestFromGroup(newGuest.guestIndex)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span></button> <label for="guestName" class="control-label" ng-show="!newGuest.isEmployee">Имя</label> <input type="text" id="guestName" class="form-control" placeholder="Имя гостя" ng-model="newGuest.name" ng-show="!newGuest.isEmployee" required> <label for="emplName" class="control-label" ng-show="newGuest.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="newGuest.isEmployee" ng-model="newGuest.emplID" ng-change="newGuest.isDirector=changeEmplIsDir(newGuest.emplID);newGuest.name=changeEmplName(newGuest.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="newGuest.isEmployee" ng-change="newGuest.isFree=newGuest.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="newGuest.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="newGuest.isDirector" ng-show="newGuest.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="newGuest.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="newGuest.isEmployeeAtWork" ng-show="newGuest.isEmployee" ng-disabled="newGuest.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!newGuest.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!newGuest.isEmployee" ng-model="newGuest.companyN" ng-change="changeDefCompanyN(newGuest.companyN)"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!newGuest.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!newGuest.isEmployee" ng-model="newGuest.promotion" ng-disabled="newGuest.isFree && disablePromoSelectAD[newGuest.guestIndex]" ng-change="newGuest.isFree=changeIsFreeFlagByPromo(newGuest.promotion,\'AD\',newGuest.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newGuest.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="newGuest.isFree" ng-disabled="newGuest.isEmployee || disableIsFreeAD[newGuest.guestIndex]" ng-change="newGuest.promotion=removePromoIfFree(newGuest.isFree,newGuest.promotion)"> Бесплатный</label> </div> </form> </td> </tr> </table> </div> <!-- add guest / company END --> <div class="row row-content"> <h4><strong>Список гостей в зале</strong></h4> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <button class="btn btn-info" id="editGuestButton" ng-show="showChangeButton" ng-click="editGuests()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Изменить</button> <button class="btn btn-warning" id="closeGuestButton" ng-show="showCloseButton" ng-click="showCheckoutModal()"> <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> Закрыть</button> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" align="right"> <!-- totals for searched items BEGIN--> <table> <tr> <td><strong>Гости:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[0]}}</strong></td> <td>&nbsp;&nbsp;&nbsp;</td> <td><strong>Сумма:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[1] | number:0}}</strong></td> </tr> </table> <!-- totals for searched items END--> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> <!-- search guest form END --> <br><br> </div> <div class="row"> <table class="table table-condensed table-responsive" ng-show="showEditGuestModal"> <!-- modify guest form BEGIN --> <tr ng-class="setRowBackgroud(guestToEdit.isFree,guestToEdit.promotion,guestToEdit.isEmployee)"> <td> <form class="form-inline" role="form" id="EditGuestForm" ng-submit="postChangesToGuest()"> <label for="guestNameEdit" class="control-label" ng-show="!guestToEdit.isEmployee">Имя</label> <input type="text" id="guestNameEdit" class="form-control" placeholder="Имя гостя" ng-model="guestToEdit.name" ng-show="!guestToEdit.isEmployee" required> <label for="emplName" class="control-label" ng-show="guestToEdit.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="guestToEdit.isEmployee" ng-model="guestToEdit.emplID" ng-change="guestToEdit.isDirector=changeEmplIsDir(guestToEdit.emplID);guestToEdit.name=changeEmplName(guestToEdit.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isEmployee" ng-change="guestToEdit.isFree=guestToEdit.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isDirector" ng-show="guestToEdit.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="guestToEdit.isEmployeeAtWork" ng-show="guestToEdit.isEmployee" ng-disabled="guestToEdit.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!guestToEdit.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.companyN"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!guestToEdit.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.promotion" ng-disabled="guestToEdit.isFree && disablePromoSelectED" ng-change="guestToEdit.isFree=changeIsFreeFlagByPromo(guestToEdit.promotion,\'ED\',guestToEdit.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="guestToEdit.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="guestToEdit.isFree" ng-disabled="guestToEdit.isEmployee || disableIsFreeED" ng-change="guestToEdit.promotion=removePromoIfFree(guestToEdit.isFree,guestToEdit.promotion)"> Бесплатный</label> </div> <button type="submit" class="btn btn-success" id="confirmAddGuestButton" ng-disabled="EditGuestForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddGuestButton" ng-click="cancelEditingGuest()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> </td> </tr> </table> <!-- modify guest form END --> </div> <div class="table-wrapper"> <!-- list of guests BEGIN --> <table class="table table-condensed table-responsive"> <thead> <tr> <th></th> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guest.isFree,guest.promotion,guest.isEmployee)" ng-repeat="guest in guests | filter:searchNameAndCompany | orderBy:\'arrivalTime\':true track by guest.id" ng-show="showGuests"> <td><input type="checkbox" ng-model="guest.isChecked"></td> <td><strong>{{guest.name}}</strong></td> <td>{{guest.companyN}}</td> <td align="center"><strong>{{guest.amount | number:0}}</strong></td> <td>{{convertMinutes(guest.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!guest.isEmployee">Клиент</p><p ng-if="guest.isEmployee && guest.isEmployeeAtWork && !guest.isDirector">Сотрудник Смена</p><p ng-if="guest.isEmployee && !guest.isEmployeeAtWork && !guest.isDirector">Сотрудник Просто</p><p ng-if="guest.isEmployee && guest.isDirector">Директор</p></td> <td><p ng-if="guest.isFree">Бесплатно</p><p ng-if="!guest.isFree">Платно</p></td> <td>{{getPromoNameById(guest.promotion)}}</td> <td class="narrowColumn">{{guest.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guest.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> </div> </div>'),a.put("views/modal.html",'<div class="Modal-backdrop"></div> <div class="Modal-holder" ui-view="modal" autoscroll="false"></div>'),a.put("views/preferences.html",'<div class="container"> <div class="row row-content"> <h4><strong>Сотрудники</strong></h4> <!-- add employee form BEGIN --> <button class="btn btn-primary" id="addEmplButton" ng-click="toggleAddEmployeeModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить сотрудника</button> <button class="btn btn-danger" id="deleteEmpl" ng-click="deleteEmpl()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить сотрудника</button> <br> <div class="row row-content"> <br><br> <modal title="Добавить пользователя" ng-show="showAddEmployeeModal"> <form class="form-inline" role="form" id="AddEmplForm" ng-submit="addNewEmpl()"> <label for="emplName" class="control-label">Имя сотрудника</label> <input type="text" id="emplName" class="form-control" ng-model="newEmpl.name" required> <div class="checkbox"> <label><input type="checkbox" id="isDir" ng-model="newEmpl.isDirector"> Директор?</label> </div> <hr><br> <button type="submit" class="btn btn-primary" id="confirmAddEmplButton" ng-disabled="AddEmplForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddUserButton" ng-click="cancelAddingEmployee()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add employee form END --> <!-- list of employees BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Имя</th> <th>Директор?</th> </tr> </thead> <tbody> <tr ng-repeat="employee in employees | orderBy:\'name\' track by employee.id" ng-show="showEmps"> <td><input type="checkbox" ng-model="employee.isSelected"></td> <td>{{employee.name}}</td> <td><p ng-if="employee.isDirector">Да</p><p ng-if="!employee.isDirector">Нет</p></td> </tr> </tbody> </table> </div> <!-- list of employees END --> </div> <div class="row row-content"> <!-- add user form BEGIN --> <h4><strong>Пользователи системы</strong></h4> <button class="btn btn-primary" id="addUserButton" ng-click="toggleAddUserModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить пользователя</button> <button class="btn btn-danger" id="deleteUser" ng-click="DeleteUser()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить пользователя</button> <div class="row row-content"> <modal title="Добавить пользователя" ng-show="showAddUserModal"> <form class="form-horizontal" role="form" id="AddUserForm" ng-submit="register()"> <hr> <label for="userEmail" class="control-label">E-mail</label> <input type="email" id="userEmail" class="form-control" placeholder="E-mail" ng-model="email" required> <label for="role" class="control-label">Роль</label> <select class="form-control" id="role" ng-model="selectedRole" ng-options="role.name for role in roles" required></select> <label for="userPassword" class="control-label">Пароль</label> <input type="password" id="userPassword" class="form-control" placeholder="пароль" ng-model="password" required> <label for="userPasswordConf" class="control-label">Повторите пароль</label> <input type="password" id="userPasswordConf" class="form-control" placeholder="повторите пароль" ng-model="passwordConf" required> <br> <button type="submit" class="btn btn-primary" id="confirmAddUserButton" ng-disabled="AddUserForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddUserButton" ng-click="cancelAddingUser()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add user form END --> <br> <!-- list of users BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>E-mail</th> <th>Дата создания</th> <th>Роль</th> </tr> </thead> <tbody> <tr ng-repeat="staff in staffs | orderBy:\'email\' track by staff.id" ng-show="showUsers"> <td><input type="checkbox" ng-model="staff.isSelected"></td> <td>{{staff.email}}</td> <td>{{staff.created | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{ShowUserRole(staff.id)}}</td> </tr> </tbody> </table> </div> <!-- list of users END --> <h4><strong>Акции</strong></h4> <button class="btn btn-primary" id="addPromoButton" ng-click="toggleAddPromotionModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить акцию</button> <button class="btn btn-warning" id="activatePromo" ng-click="ToggleIsActiveFlagPromotion()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Активировать/Деактивировать</button> <!-- add promotion form BEGIN --> <div class="row row-content"> <modal title="Add promotion" ng-show="showAddPromotionModal"> <form class="form-horizontal" role="form" id="AddPromotionForm" ng-submit="addPromotion()"> <hr> <label for="promoName" class="control-label">Название</label> <input type="text" id="promoName" class="form-control" placeholder="Название акции" ng-model="newPromotion.name" required> <label for="promoType" class="control-label">Тип акции</label> <select class="form-control" id="promoType" ng-model="newPromotion.typeDesc" required> <option ng-repeat="promotionType in promotionTypes">{{promotionType.desc}}</option> </select> <label for="promoValue" class="control-label">Значение (тг. или %)</label> <input type="number" id="promoValue" class="form-control" placeholder="Значение (тг. если тип = фиксированная стоимость, % - если скидка)" ng-model="newPromotion.value" min="0" required> <br> <button type="submit" class="btn btn-primary" id="confirmAddPromoButton" ng-disabled="AddPromotionForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddPromoButton" ng-click="cancelAddingPromotion()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add promotion form END --> <br> <!-- list of promotions BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Активна?</th> <th>Название акции</th> <th>Тип</th> <th>Значение (тг. или %)</th> </tr> </thead> <tbody> <tr ng-repeat="promotion in promotions | orderBy:\'isActive\':true track by promotion.id" ng-show="showPromos"> <td><input type="checkbox" ng-model="promotion.isSelected"></td> <td><input type="checkbox" ng-model="promotion.isActive" disabled></td> <td>{{promotion.name}}</td> <td>{{promotion.typeDesc}}</td> <td>{{promotion.value}}</td> </tr> </tbody> </table> </div> <!-- list of promotions END --> <h4><strong>Значения констант</strong></h4> <!-- list of consts BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th>Название</th> <th>Описание</th> <th>Значение</th> </tr> </thead> <tbody> <tr ng-repeat="const in consts | orderBy:\'name\' track by const.name"> <td>{{const.name}}</td> <td>{{const.desc}}</td> <td>{{const.value}}</td> </tr> </tbody> </table> </div> <!-- list of consts END --> </div> </div>'),a.put("views/reservations.html",'<div class="container-fluid"> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <!-- ADD new booking form BEGIN --> <div class="row" ng-show="showAddBookingForm"> <h4><strong>Добавить бронь</strong></h4> <form class="form-inline" role="form" id="AddBookingForm" ng-submit="addBooking(newBooking)"> <div class="form-group"> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="newBooking.name"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="newBooking.phone" required> <label for="dateSelect" class="control-label">Дата и время брони</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="newBooking.date" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="dateSelect" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false"> </datetimepicker> </div> <br><br> <div class="form-group"> <label for="numberofguests" class="control-label">Кол-во человек</label> <input type="number" min="1" id="numberofguests" class="form-control" ng-model="newBooking.numberOfPeople"> <div class="checkbox"> <label><input type="checkbox" ng-model="newBooking.isBirthday"> Есть именинник?</label> </div> <label for="place" class="control-label">Посадка</label> <input type="text" id="place" class="form-control" ng-model="newBooking.place"> <label for="payment" class="control-label">Сумма предоплаты</label> <input type="number" min="0" id="payment" class="form-control" ng-model="newBooking.prePayment"> </div> <br><br> <div class="form-group"> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newBooking.comment"> </div> <br><br> <button type="submit" class="btn btn-success" id="confirmAddBookingButton" ng-disabled="AddBookingForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddBookingButton" ng-click="cancelAddingBooking()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Отменить</button> </form> </div> <!-- add new booking form END --> <hr> <!-- modify booking form BEGIN --> <div class="row" ng-show="showEditBookingForm"> <h4><strong>Изменить бронь</strong></h4> <form class="form-inline" role="form" id="EditBookingForm" ng-submit="postChangesToBooking(modifiedBooking)"> <div class="form-group"> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="modifiedBooking.name" ng-disabled="true"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="modifiedBooking.phone" ng-disabled="true" required> <label for="dateSelect" class="control-label">Дата и время брони</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="modifiedBooking.date" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="dateSelect" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false"> </datetimepicker> </div> <br><br> <div class="form-group"> <label for="numberofguests" class="control-label">Кол-во человек</label> <input type="number" min="1" id="numberofguests" class="form-control" ng-model="modifiedBooking.numberOfPeople"> <div class="checkbox"> <label><input type="checkbox" ng-model="modifiedBooking.isBirthday"> Есть именинник?</label> </div> <label for="place" class="control-label">Посадка</label> <input type="text" id="place" class="form-control" ng-model="modifiedBooking.place"> <label for="payment" class="control-label">Сумма предоплаты</label> <input type="number" min="0" id="payment" class="form-control" ng-model="modifiedBooking.prePayment"> </div> <br><br> <div class="form-group"> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="modifiedBooking.comment"> </div> <br><br> <button type="submit" class="btn btn-success" id="confirmModifyBookingButton" ng-disabled="EditBookingForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Изменить</button> <button type="button" class="btn btn-danger" id="cancelModifyBookingButton" ng-click="cancelEditingBooking()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Отменить</button> </form> </div> <!-- modify booking form END --> <h4><strong>Список броней</strong></h4> <!-- list of bookings - search form BEGIN --> <form class="form-inline" role="form" id="searchForm" ng-show="showSearchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> <span>&nbsp;&nbsp;&nbsp;</span> <button type="button" class="btn btn-default" ng-disabled="!TodayBookingsBtn" ng-click="showTodayBookings()">На сегодня</button> <button type="button" class="btn btn-default" ng-disabled="!TodayAndFutureBookingsBtn" ng-click="showTodayAndFutureBookings()">Сегодня и будущие</button> <button type="button" class="btn btn-default" ng-disabled="!AllBookingsBtn" ng-click="showAllBookings()">Все брони</button> <button type="button" class="btn btn-default" ng-disabled="!PastYearBookingsBtn" ng-click="showPastYearBookings()">Прошлогодние брони</button> </form> <br> <form class="form-inline" role="form" ng-show="showSearchForm"> <button type="button" class="btn btn-success" ng-click="changeBookingStatus(statuses[1])"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Пришли</button> <button type="button" class="btn btn-warning" ng-click="changeBookingStatus(statuses[2])"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Не пришли</button> <button type="button" class="btn btn-danger" ng-click="changeBookingStatus(statuses[3])"> <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>Отменить бронь</button> <button type="button" class="btn btn-info" ng-click="showModifyBookingForm()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>Изменить бронь</button> </form> <!-- list of bookings - search form END --> <br> <!-- list of bookings BEGIN --> <div class="table-wrapper"> <table class="table table-condensed table-responsive"> <thead> <tr> <th></th> <th>Мобильный телефон</th> <th>Имя</th> <th class="narrowColumn">Дата брони</th> <th>Кол-во человек</th> <th>Посадка</th> <th>Именинник?</th> <th>Предоплата</th> <th>Комментарий</th> <th>Статус</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(booking.status)" ng-repeat="booking in bookings | orderBy:\'date\' | filter:search track by booking.id" ng-show="showInfo"> <td><input type="checkbox" ng-model="booking.isSelected"></td> <td>{{booking.phone | phoneFilter}}</td> <td>{{booking.name}}</td> <td class="narrowColumn">{{booking.date | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{booking.numberOfPeople}}</td> <td>{{booking.place}}</td> <td><p ng-if="booking.isBirthday">Да</p><p ng-if="!booking.isBirthday">Нет</p></td> <td>{{booking.prePayment | number:0}}</td> <td>{{booking.comment}}</td> <td>{{booking.status}}</td> </tr> </tbody> </table> </div> <!-- list of bookings END --> </div>'),a.put("views/stat.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showData" ng-click="getDatesAndFetchClients(startDate,endDate)">Показать статистику</button> </div> </form> </div> <hr> </div> <div class="container"> <div class="row" ng-if="showMessage"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="row" ng-show="showInfo"> <h4><strong>Статистика за период с {{startDate | date: \'dd.MM.y H:mm:ss\'}} по {{endDate | date: \'dd.MM.y H:mm:ss\'}}</strong></h4> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th>Категория</th> <th>Кол-во</th> <th>Сумма</th> <th>Средний чек</th> </tr> </thead> <tbody> <tr ng-repeat="outStat in outStat"> <td>{{outStat.category}}</td> <td>{{outStat.n}}</td> <td>{{outStat.sum | number:0}}</td> <td>{{outStat.av | number:0}}</td> </tr> </tbody> </table> </div> </div> </div> <div class="container"> <div class="row" ng-show="showInfo"> <div> <h4><strong>Кол-во гостей</strong></h4> <angular-chart options="chartGuestsOptions"></angular-chart> </div> <div> <h4><strong>Суммы</strong></h4> <angular-chart options="chartAmountsOptions"></angular-chart> </div> </div> </div>')}]);